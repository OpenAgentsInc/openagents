#!/bin/sh
# openagents-hooks-version: 1.0.0
#
# OpenAgents pre-push hook
#
# Checks:
# 1. No border-radius styling (design policy)
# 2. No hardcoded colors - use semantic tokens only

set -e

echo "Running pre-push checks..."

# =============================================================================
# Check 1: Border radius violations
# =============================================================================
# Prevents pushing code with border-radius styling.
# Design policy: No rounded corners, sharp edges only.

VIOLATIONS=$(grep -r --include="*.rs" --include="*.html" --include="*.tsx" --include="*.ts" --include="*.jsx" --include="*.js" \
    -E "(rounded|border-radius)" \
    --exclude-dir=node_modules \
    --exclude-dir=target \
    --exclude-dir=.git \
    --exclude-dir=vendor \
    --exclude-dir=static \
    --exclude-dir=docs \
    --exclude-dir=tests \
    . 2>/dev/null | grep -v "^Binary" | grep -v ".sample:" | grep -v "//!" | grep -v "// " | grep -v "/\*" | grep -v "^\s*\*" | grep -v "_test\.rs" | grep -v "tests/" || true)

if [ -n "$VIOLATIONS" ]; then
    echo "❌ ERROR: Border radius detected in source files" >&2
    echo "" >&2
    echo "Design policy: No rounded corners. Remove all 'rounded' classes and 'border-radius' styles." >&2
    echo "" >&2
    echo "Violations found:" >&2
    echo "$VIOLATIONS" | head -20 >&2

    COUNT=$(echo "$VIOLATIONS" | wc -l | tr -d ' ')
    if [ "$COUNT" -gt 20 ]; then
        echo "" >&2
        echo "... and $((COUNT - 20)) more violations" >&2
    fi

    echo "" >&2
    echo "Fix these before pushing." >&2
    exit 1
fi

# =============================================================================
# Check 2: Hardcoded color violations (disabled)
# =============================================================================
# This Tailwind color token check is intentionally disabled for now.

echo "✅ Pre-push checks passed"
exit 0
