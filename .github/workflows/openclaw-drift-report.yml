name: OpenClaw Drift Report

on:
  workflow_dispatch:
  schedule:
    - cron: "0 9 * * 1"
  push:
    branches:
      - main
    paths:
      - "docs/plans/active/openclaw-intake/**"
      - "apps/openagents-runtime/test/fixtures/openclaw/**"
      - "scripts/openclaw-drift-report.sh"
      - ".github/workflows/openclaw-drift-report.yml"

jobs:
  drift-report:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ripgrep

      - name: Generate drift report (strict actionable gate)
        run: OPENCLAW_DRIFT_FAIL_ON_ACTIONABLE=1 scripts/openclaw-drift-report.sh

      - name: Upload drift report artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: openclaw-drift-report
          path: docs/plans/active/openclaw-drift-report.md
