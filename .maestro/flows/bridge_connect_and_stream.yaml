appId: com.openagents.app
name: Bridge Connect and Stream
---
- launchApp
- openLink: "exp://localhost:8081"
- openLink: "exp://localhost:8081/--/settings"
- extendedWaitUntil:
    visible:
      id: settings-root
    timeout: 90000
- tapOn:
    id: settings-host-input
- inputText:
    id: settings-host-input
    text: "192.168.1.11:8788"
- tapOn:
    id: settings-token-input
- inputText:
    id: settings-token-input
    text: "2d716c46ffb7b1c788db80b8cc21a027101dfad9372659339a48bd0d48ddf7ce"
- tapOn:
    id: settings-apply
- runFlow:
    when:
      visible:
        id: settings-connect
    commands:
      - tapOn:
          id: settings-connect
- extendedWaitUntil:
    visible:
      id: header-connection-indicator
    timeout: 120000
# Start a new chat and send a warm-up message
- tapOn:
    id: header-new-chat
- extendedWaitUntil:
    visible:
      id: composer-input
    timeout: 60000
- inputText:
    id: composer-input
    text: "warmup"
- tapOn:
    id: composer-send

# Then send main message and assert reply
- inputText:
    id: composer-input
    text: "Hello from Maestro"
- tapOn:
    id: composer-send
# Ensure our send is reflected in the UI first
- extendedWaitUntil:
    visible:
      id: user-message
    timeout: 60000
# Prefer an agent message; fall back to tool-call or agent-thought if needed
- extendedWaitUntil:
    visible:
      id: agent-message
    timeout: 120000
- runFlow:
    when:
      notVisible:
        id: agent-message
    commands:
      - extendedWaitUntil:
          visible:
            id: tool-call
          timeout: 120000
- runFlow:
    when:
      notVisible:
        id: agent-message
    commands:
      - extendedWaitUntil:
          visible:
            id: agent-thought
          timeout: 120000
# Retry once if no agent message rendered yet
- runFlow:
     when:
       notVisible:
         id: agent-message
     commands:
      - extendedWaitUntil:
          visible:
            id: composer-input
          timeout: 60000
      - inputText:
          id: composer-input
          text: "Hello again"
      - tapOn:
          id: composer-send
      - extendedWaitUntil:
          visible:
            id: agent-message
          timeout: 120000
# Finally, open drawer and assert history container
- tapOn:
    id: header-menu-button
- extendedWaitUntil:
    visible:
      id: drawer-threads
    timeout: 60000
