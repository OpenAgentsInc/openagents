appId: com.openagents.app
name: Bridge â†’ Header Connection Indicator
---
- launchApp
- openLink: "${EXP_URL}"
# Prefer drawer navigation to Settings for reliability
- runFlow:
    when:
      visible:
        id: header-menu-button
    commands:
      - tapOn:
          id: header-menu-button
      - extendedWaitUntil:
          visible:
            id: drawer-settings
          timeout: 30000
      - tapOn:
          id: drawer-settings
# If Dev Quick Connect is available, use it (reads EXPO_PUBLIC_* from app env)
- runFlow:
    when:
      visible:
        id: settings-dev-quick
    commands:
      - tapOn:
          id: settings-dev-quick
      - extendedWaitUntil:
          visible:
            id: header-connection-indicator
          timeout: 120000
# Otherwise, deep-link fallback and manual entry using Maestro env vars
- runFlow:
    when:
      notVisible:
        id: settings-host-input
    commands:
      - openLink: "${EXP_URL}/--/settings"
      - extendedWaitUntil:
          visible:
            id: settings-host-input
          timeout: 90000
- runFlow:
    when:
      visible:
        id: settings-host-input
    commands:
      - tapOn:
          id: settings-host-input
      - inputText:
          id: settings-host-input
          text: "${BRIDGE_HOST}"
      - tapOn:
          id: settings-token-input
      - inputText:
          id: settings-token-input
          text: "${BRIDGE_TOKEN}"
      - tapOn:
          id: settings-apply
      - runFlow:
          when:
            visible:
              id: settings-connect
          commands:
            - tapOn:
                id: settings-connect
# Assert the header connection indicator exists
- extendedWaitUntil:
    visible:
      id: header-connection-indicator
    timeout: 120000
