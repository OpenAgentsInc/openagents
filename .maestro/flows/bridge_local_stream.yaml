appId: com.openagents.app
name: Bridge Local Stream (Manual Code)
---
- launchApp
- openLink: "exp://localhost:8081"
# Navigate to onboarding (Expo dev-client route)
- openLink: "exp://localhost:8081"
# Try dev quick connect first (development only)
- runFlow:
    when:
      visible:
        id: dev-quick-connect
    commands:
      - tapOn:
          id: dev-quick-connect
# Open Settings via the drawer (header must be visible on root)
- tapOn:
    id: header-menu-button
- extendedWaitUntil:
    visible:
      id: drawer-settings
    timeout: 30000
- tapOn:
    id: drawer-settings
- extendedWaitUntil:
    visible:
      id: settings-status
    timeout: 30000
- runFlow:
    when:
      visible:
        id: settings-dev-quick
    commands:
      - tapOn:
          id: settings-dev-quick
- runFlow:
    when:
      visible:
        id: settings-connect
    commands:
      - tapOn:
          id: settings-connect
- runFlow:
    when:
      visible:
        text: Connected
    commands:
      - extendedWaitUntil:
          visible:
            text: Connected
          timeout: 60000
# Fallback: proceed if header indicator is visible
- extendedWaitUntil:
    visible:
      id: header-connection-indicator
    timeout: 120000
# Start a new chat from header
- tapOn:
    id: header-new-chat
# Ensure composer is visible
- extendedWaitUntil:
    visible:
      id: composer-input
    timeout: 60000
# Otherwise, navigate to manual code screen and paste JSON
- runFlow:
    when:
      visible:
        text: "Enter code manually"
    commands:
      - tapOn:
          id: onboarding-manual-link
      - tapOn:
          text: "Paste pairing code or link"
      - inputText: '{"v":1,"type":"bridge","hosts":["127.0.0.1:8787"],"token":"test"}'
      - tapOn:
          text: "Connect"
# Header indicator already checked above; keep going
- tapOn:
    id: header-new-chat
- inputText:
    id: composer-input
    text: "Hello from Maestro"
- tapOn:
    id: composer-send
- extendedWaitUntil:
    visible:
      id: user-message
    timeout: 90000
- extendedWaitUntil:
    visible:
      id: agent-message
    timeout: 120000
