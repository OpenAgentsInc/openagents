appId: com.openagents.app
name: Thread: send and assert one user + one assistant
---
# Launch and warm base route
- launchApp
- openLink: "${EXP_URL}"

# Ensure connection: prefer Dev Quick Connect; fall back to manual using env
- runFlow:
    when:
      notVisible:
        id: header-connection-indicator
    commands:
      - runFlow:
          when:
            visible:
              id: header-menu-button
          commands:
            - tapOn:
                id: header-menu-button
            - extendedWaitUntil:
                visible:
                  id: drawer-settings
                timeout: 30000
            - tapOn:
                id: drawer-settings
      - runFlow:
          when:
            visible:
              id: settings-dev-quick
          commands:
            - tapOn:
                id: settings-dev-quick
      - runFlow:
          when:
            notVisible:
              id: header-connection-indicator
          commands:
            - openLink: "${EXP_URL}/--/settings"
            - extendedWaitUntil:
                visible:
                  id: settings-host-input
                timeout: 90000
            - tapOn:
                id: settings-host-input
            - inputText:
                id: settings-host-input
                text: "${BRIDGE_HOST}"
            - tapOn:
                id: settings-token-input
            - inputText:
                id: settings-token-input
                text: "${BRIDGE_TOKEN}"
            - tapOn:
                id: settings-apply
            - runFlow:
                when:
                  visible:
                    id: settings-connect
                commands:
                  - tapOn:
                      id: settings-connect
      - extendedWaitUntil:
          visible:
            id: header-connection-indicator
          timeout: 120000

# Open a new thread and send "Hi"
- tapOn:
    id: header-new-chat
- extendedWaitUntil:
    visible:
      id: composer-input
    timeout: 60000
- inputText:
    id: composer-input
    text: "Hi"
- tapOn:
    id: composer-send

# Assert one user and one assistant bubble render
# We assert visibility for anchors at least once; for stronger checks, add a query step.
- extendedWaitUntil:
    visible:
      id: user-message
    timeout: 90000
- extendedWaitUntil:
    visible:
      id: agent-message
    timeout: 120000

