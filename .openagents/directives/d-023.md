---
id: "d-023"
title: "WGPUI - GPU-Accelerated UI Framework"
status: active
priority: high
created: 2025-12-24
updated: 2025-12-24
---

## What is WGPUI?

WGPUI is OpenAgents' custom GPU-accelerated UI framework built in Rust. It provides the rendering foundation for all OpenAgents desktop and web applications, enabling high-performance, cross-platform UI with native-level performance.

**Location:** `crates/wgpui/`

## Why WGPUI Exists

### The GPUI Inspiration

WGPUI is inspired by [GPUI](https://gpui.rs/), the UI framework created by [Zed](https://zed.dev/) for their code editor. GPUI is an excellent framework with:

- Immediate-mode rendering
- Fine-grained reactivity
- Direct GPU access via Metal (macOS)
- High performance text rendering

**However, GPUI uses Metal for rendering, which only works on macOS/iOS.**

### The WebGPU Solution

OpenAgents needed a UI framework that works everywhere:
- Desktop (Linux, macOS, Windows)
- Web browsers (via WebAssembly + WebGPU)
- Eventually mobile

**WGPUI solves this by using wgpu instead of Metal.** wgpu is a cross-platform graphics API that:
- Translates to Vulkan on Linux
- Translates to Metal on macOS
- Translates to DirectX 12 on Windows
- Runs natively as WebGPU in browsers

This means the same Rust UI code renders everywhere with GPU acceleration.

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│  Application Layer                                           │
│  (openagents binary, autopilot-gui, etc.)                   │
├─────────────────────────────────────────────────────────────┤
│  Components                                                  │
│  ├── Atoms (StatusDot, ModeBadge, StreamingIndicator)       │
│  ├── Molecules (MessageHeader, ModeSelector)                │
│  ├── Organisms (ChatPanel, DiffViewer)                      │
│  ├── Sections (ThreadView, SplitPane)                       │
│  └── HUD (Frame, DotsGrid, StatusBar, Notifications)        │
├─────────────────────────────────────────────────────────────┤
│  Core Systems                                                │
│  ├── Animation (Animation<T>, Spring, Keyframe, Easing)     │
│  ├── Text (TextSystem, cosmic-text integration)             │
│  ├── Theme (Colors, Typography, Spacing)                    │
│  └── Markdown (Parser, Highlighter, Streaming)              │
├─────────────────────────────────────────────────────────────┤
│  Rendering                                                   │
│  ├── Scene (draw_quad, draw_text, draw_image)               │
│  ├── Renderer (wgpu pipelines, buffers, shaders)            │
│  └── Layout (Bounds, Size, Point, positioning)              │
├─────────────────────────────────────────────────────────────┤
│  wgpu (Cross-platform GPU abstraction)                       │
│  ├── Vulkan (Linux)                                          │
│  ├── Metal (macOS)                                           │
│  ├── DirectX 12 (Windows)                                    │
│  └── WebGPU (Browsers)                                       │
└─────────────────────────────────────────────────────────────┘
```

## Key Concepts

### Component Trait

All UI elements implement the `Component` trait:

```rust
pub trait Component {
    fn paint(&mut self, bounds: Bounds, cx: &mut PaintContext);
    fn event(&mut self, event: &InputEvent, bounds: Bounds, cx: &mut EventContext) -> EventResult;
    fn id(&self) -> Option<ComponentId> { None }
    fn size_hint(&self) -> (Option<f32>, Option<f32>) { (None, None) }
}
```

### Scene-Based Rendering

Components don't render directly to GPU. They build a `Scene` of draw commands:

```rust
// Drawing primitives
scene.draw_quad(Quad::new(bounds).with_background(color));
scene.draw_text(text_run);
scene.draw_image(texture, bounds);

// The renderer batches and submits to GPU
renderer.prepare(&device, &scene);
renderer.render(&mut encoder, &view);
```

### Animation System

Rich animation support inspired by both GPUI and Arwes:

```rust
// Tween animation with easing
let anim = Animation::new(0.0, 100.0, Duration::from_millis(500))
    .easing(Easing::EaseOutCubic);

// Spring physics
let spring = SpringAnimation::new(0.0, 100.0)
    .stiffness(100.0)
    .damping(10.0);

// Keyframe sequences
let keyframes = KeyframeAnimation::new()
    .keyframe(0.0, 0.0)
    .keyframe(0.5, 150.0)
    .keyframe(1.0, 100.0);
```

### Theme System

Centralized theming with Tailwind-inspired color tokens:

```rust
use wgpui::theme;

// Background colors
theme::bg::APP      // Main app background
theme::bg::SURFACE  // Card/panel backgrounds
theme::bg::MUTED    // Subtle backgrounds

// Text colors
theme::text::PRIMARY   // Main text
theme::text::MUTED     // Secondary text

// Accent colors
theme::accent::PRIMARY // Brand color (cyan)
theme::accent::GREEN   // Success
theme::accent::RED     // Error
```

## Current State

**60+ Components** across 5 categories:
- **Atoms**: 13 components (StatusDot, ModeBadge, ModelBadge, etc.)
- **Molecules**: 10 components (MessageHeader, ModeSelector, etc.)
- **Organisms**: 10+ components (ChatPanel, DiffViewer, etc.)
- **Sections**: ThreadView, SplitPane, etc.
- **HUD**: Frame (6 styles), DotsGrid, StatusBar, Notifications, etc.

**Animation System**:
- 13 easing functions
- Spring physics
- Keyframe animations
- Frame-level animations (Fade, Draw, Flicker, Assemble)

**Text Rendering**:
- cosmic-text integration
- Glyph atlas caching
- Markdown with syntax highlighting

**405+ Tests** covering all components and systems.

## Comparison with Alternatives

| Feature | WGPUI | GPUI (Zed) | egui | Dioxus |
|---------|-------|------------|------|--------|
| GPU Backend | wgpu | Metal | wgpu/glow | DOM |
| Cross-Platform | Yes | macOS only | Yes | Yes |
| Web Support | Yes (WebGPU) | No | Yes | Yes |
| Reactivity | Signal-based | Yes | Immediate | Virtual DOM |
| Performance | Native | Native | Native | Web-level |

## Running Examples

```bash
# Full component showcase
cargo run -p wgpui --example first_light --features desktop --release

# Pane animation demo
cargo run -p wgpui --example pane_sequence --features desktop --release
```

## Reference Code

- **Zed GPUI**: `~/code/zed/crates/gpui/` - Original inspiration
- **Arwes**: `~/code/arwes/packages/` - Sci-fi UI patterns
- **Previous Implementations**: `~/code/backroom/archive/openagents/coder/` - Earlier WGPUI integration

## Related Directives

- **d-020** - WGPUI Integration (integrating WGPUI into OpenAgents apps)
- **d-024** - Arwes Parity (achieving feature parity with Arwes sci-fi framework)
- **d-011** - Storybook Coverage (visual testing for components)
