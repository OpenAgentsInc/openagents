---
id: "d-024"
title: "Achieve 100% Arwes Parity in WGPUI"
status: active
priority: high
created: 2025-12-24
updated: 2025-12-24
---

## Goal

Achieve complete feature parity between wgpui and Arwes, the futuristic sci-fi UI framework. Every visual component, animation primitive, and effect available in Arwes should be implementable in wgpui using GPU-accelerated Rust.

## Background

Arwes is a comprehensive futuristic sci-fi UI framework with 23 core packages covering frames, animations, text effects, backgrounds, audio, and theming. OpenAgents has already ported the foundational elements to wgpui (`crates/wgpui/`), including 6 frame styles, 13 easing functions, and the DotsGrid background. This directive completes the migration by implementing all remaining Arwes features.

**Current wgpui state:**
- 60+ components (atoms, molecules, organisms, sections, HUD)
- 6 frame styles: Corners, Lines, Octagon, Underline, Nefrex, Kranox
- 13 easing functions
- Animation/SpringAnimation/KeyframeAnimation primitives
- DotsGrid background
- Static theme system

**Reference implementation:** `~/code/arwes/packages/`

## Architecture

```
crates/wgpui/src/
├── animation/
│   ├── mod.rs
│   ├── animation.rs      # Animation<T> (exists)
│   ├── spring.rs         # SpringAnimation (exists)
│   ├── easing.rs         # +18 new easing functions
│   ├── animator.rs       # NEW: Orchestration system
│   └── transitions.rs    # NEW: fade, flicker, draw builders
├── components/
│   ├── hud/
│   │   ├── frame.rs      # +3 frame styles (Nero, Header, Circle)
│   │   └── backgrounds/  # NEW module
│   │       ├── mod.rs
│   │       ├── puffs.rs
│   │       ├── grid_lines.rs
│   │       └── moving_lines.rs
│   └── text_effects/     # NEW module
│       ├── mod.rs
│       ├── sequence.rs   # Char-by-char reveal
│       └── decipher.rs   # Scramble effect
├── effects/
│   └── illuminator.rs    # NEW: Radial glow
└── theme/
    └── dynamic.rs        # NEW: Multipliers, units, breakpoints
```

**Animator Communication Pattern:**
Uses mpsc channels for parent-child state propagation (Rust-idiomatic, async-compatible):

```rust
pub struct AnimatorNode {
    id: AnimatorId,
    state: AnimatorState,  // Entered, Entering, Exiting, Exited
    parent_tx: Option<Sender<AnimatorMessage>>,
    children_rx: Receiver<AnimatorMessage>,
    manager: AnimatorManager,  // Parallel, Stagger, Sequence, Switch
}
```

## Success Criteria

### Phase 1: Animation Foundation
- [ ] Add Quart easing family (inQuart, outQuart, inOutQuart)
- [ ] Add Quint easing family (inQuint, outQuint, inOutQuint)
- [ ] Add Sine easing family (inSine, outSine, inOutSine)
- [ ] Add Expo easing family (inExpo, outExpo, inOutExpo)
- [ ] Add Circ easing family (inCirc, outCirc, inOutCirc)
- [ ] Add Bounce easing family (inBounce, outBounce, inOutBounce)
- [ ] Create AnimatorNode with state machine (entered/entering/exiting/exited)
- [ ] Create AnimatorManager strategies (parallel, stagger, sequence, switch)
- [ ] Implement animator hierarchy with channel-based communication
- [ ] Add fade transition builder
- [ ] Add flicker transition builder
- [ ] Add draw transition builder (SVG path animation)

### Phase 2: Frame Completion
- [ ] Implement Nero frame style
- [ ] Implement Header frame style
- [ ] Implement Circle frame style
- [ ] Ensure all 9 frames support animation modes (Fade, Draw, Flicker, Assemble)
- [ ] Add frame animation integration with Animator system

### Phase 3: Text Effects
- [ ] Implement Sequence text animation (char-by-char reveal)
- [ ] Add configurable reveal timing (duration, delay per character)
- [ ] Implement Decipher text effect (scramble during reveal)
- [ ] Add custom character set support for Decipher
- [ ] Implement blinking cursor
- [ ] Integrate text effects with Animator lifecycle

### Phase 4: Background Effects
- [ ] Implement Puffs background (expanding circles from random points)
- [ ] Implement GridLines background (regular grid pattern)
- [ ] Implement MovingLines background (animated directional lines)
- [ ] Use wgpu shaders for GPU acceleration (not Canvas2D)
- [ ] Add animation integration for all backgrounds

### Phase 5: Visual Effects
- [ ] Implement Illuminator effect (radial glow following element/cursor)
- [ ] Add configurable glow radius, color, and intensity
- [ ] Implement SVG-based Illuminator variant for vector output

### Phase 6: Dynamic Theme
- [ ] Add theme multipliers (scaling functions for sizing)
- [ ] Add dynamic units (unit value generators)
- [ ] Add responsive breakpoints with up/down/between helpers
- [ ] Integrate with existing theme module

## Key Files to Create/Modify

| File | Purpose |
|------|---------|
| `crates/wgpui/src/animation/easing.rs` | Add 18 new easing functions |
| `crates/wgpui/src/animation/animator.rs` | **NEW** - Animator orchestration |
| `crates/wgpui/src/animation/transitions.rs` | **NEW** - Transition builders |
| `crates/wgpui/src/components/hud/frame.rs` | Add Nero, Header, Circle frames |
| `crates/wgpui/src/components/text_effects/mod.rs` | **NEW** - Text effects module |
| `crates/wgpui/src/components/text_effects/sequence.rs` | **NEW** - Sequence animation |
| `crates/wgpui/src/components/text_effects/decipher.rs` | **NEW** - Decipher effect |
| `crates/wgpui/src/components/hud/backgrounds/mod.rs` | **NEW** - Backgrounds module |
| `crates/wgpui/src/components/hud/backgrounds/puffs.rs` | **NEW** - Puffs effect |
| `crates/wgpui/src/components/hud/backgrounds/grid_lines.rs` | **NEW** - Grid pattern |
| `crates/wgpui/src/components/hud/backgrounds/moving_lines.rs` | **NEW** - Moving lines |
| `crates/wgpui/src/effects/illuminator.rs` | **NEW** - Radial glow effect |
| `crates/wgpui/src/theme/dynamic.rs` | **NEW** - Dynamic theme features |

## Dependencies

**External:**
- `tokio` - Async runtime for channel communication
- `rand` - Random number generation for Puffs/Decipher

**Internal:**
- `wgpui` - Base crate being extended
- Existing animation module provides foundation

## Testing Strategy

1. **Unit tests** for each easing function with known input/output values
2. **Animator tests** verifying state machine transitions and channel communication
3. **Visual tests** via extended `first_light.rs` example showcasing all new features
4. **Integration tests** ensuring Animator hierarchy works across component boundaries
5. **Benchmark tests** for background shader performance

## Notes

- **Canvas vs GPU**: Arwes uses Canvas2D for backgrounds; wgpui uses wgpu shaders for GPU acceleration
- **No React**: Extract algorithms from Arwes, reimplement in idiomatic Rust
- **Audio Deferred**: Bleeps/BleepsManager deferred to future directive (focus on visual parity)
- **Reference Code**: All Arwes implementations at `~/code/arwes/packages/`

## Related Directives

- **d-023** - WGPUI Overview (what WGPUI is and why it exists)
- **d-020** - WGPUI Integration (parent directive for GPU UI work)
- **d-011** - Storybook Coverage (new components need stories)
