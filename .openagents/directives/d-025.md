---
id: "d-025"
title: "All-In WGPUI - Delete Web Stack"
status: active
priority: urgent
created: 2025-12-24
updated: 2025-12-25T14:16:58Z
---

## Goal

Delete the HTMX/Maud/Tailwind web stack entirely and build all OpenAgents applications with WGPUI. The first application is autopilot-gui, rebuilt as a native WGPUI app with in-process backend (Zed's architecture pattern).

## Background

OpenAgents currently has two UI stacks:
- **Web stack** (to be deleted): Maud templates + HTMX + Tailwind, served via Actix-web in wry/tao webview
- **WGPUI** (the future): GPU-accelerated native rendering via wgpu

The web stack adds complexity (localhost server, WebSocket bridge, HTML/CSS parsing) without benefit. WGPUI already has 60+ components and full Arwes parity (d-024). Time to go all-in.

**Key decisions:**
- All-in WGPUI (no hybrid)
- First app: autopilot-gui
- In-process backend (like Zed) - no Actix server
- Move deleted code to `~/code/backroom/openagents-maud-archive/`

## Integration Notes (2025-12-25)

- GitAfter still uses wry/tao + Actix; migration to WGPUI remains pending.
- `src/gui/` is legacy and only retained for archived assets (fonts); it is not wired.

## Architecture

### Before (Web Stack)
```
main.rs -> [Actix Server] -> HTTP/WS -> [wry WebView] <- HTML
```

### After (WGPUI Native)
```
main.rs -> [winit EventLoop] -> [WGPUI Renderer] <- GPU
              |
         App Singleton (owns all state)
              |
         Entity<Model> handles
```

### Target File Structure
```
crates/autopilot-gui/
  src/
    lib.rs                  # crate entry
    main.rs                 # winit event loop, wgpu init
    app.rs                  # UI shell + panes
    backend/
      mod.rs                # Backend integration (metrics/logs/agents)
    state/
      mod.rs                # App state
    views/
      mod.rs                # View exports
      dashboard.rs          # Dashboard pane
      chat.rs               # Live stream pane
      context.rs            # Context pane
      parallel.rs           # Parallel agents pane
```

## Success Criteria

### Phase 1: Framework Foundation
- [x] Entity system with reactive state (Entity<T>, Context<T>, cx.notify()) ✅ 2025-12-24
- [x] Element trait with 3-phase lifecycle (request_layout, prepaint, paint) ✅ 2025-12-24
- [x] Window abstraction with layout engine integration ✅ 2025-12-24
- [x] Styled trait with fluent builder DSL (div().flex().bg()) ✅ 2025-12-24
- [x] App singleton with cx.spawn() async support ✅ 2025-12-24

### Phase 2: Delete Web Stack
- [x] Move crates/ui to ~/code/backroom/openagents-maud-archive/ ✅ 2025-12-24
- [x] Move crates/storybook to ~/code/backroom/openagents-maud-archive/ ✅ 2025-12-24
- [x] Move crates/autopilot-gui to ~/code/backroom/openagents-maud-archive/ ✅ 2025-12-24
- [x] Remove maud, actix-web, wry, tao from workspace Cargo.toml ✅ 2025-12-24
- [x] Remove HTMX/Maud references from AGENTS.md and SYNTHESIS.md ✅ 2025-12-24

### Phase 3: Autopilot-GUI Native
- [x] winit/wgpu application shell
- [x] Pane layout with Dashboard, Chat, Context, Parallel (no permissions pane; auto-approved)
- [x] Dashboard with session list and stats
- [x] Chat pane streaming latest rlog lines
- [x] Permissions auto-approved (no modal in this phase)
- [x] In-process backend integration via channels

### Phase 4: ACP Component Parity
- [x] ACP atoms/molecules/organisms ported to WGPUI ✅ 2025-12-25
- [x] WGPUI storybook example for ACP component development ✅ 2025-12-25

## Issues

### Framework Foundation (Phase 1)

#### Issue 1: Entity System ✅ COMPLETE
**Title:** Implement GPUI-style Entity system in WGPUI
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:** Add reactive state management with Entity<T> handles, Context<T> wrapper, and automatic invalidation via cx.notify().

Files created:
- `crates/wgpui/src/app/mod.rs` ✅
- `crates/wgpui/src/app/entity_map.rs` - SlotMap-based entity storage with Entity<T>, WeakEntity<T>, AnyEntity, Lease ✅
- `crates/wgpui/src/app/app_context.rs` - App singleton and Context<T> with notify/observe/update_entity ✅
- `crates/wgpui/src/app/subscription.rs` - Subscription with drop cleanup, SubscriberSet ✅

12 unit tests passing.

Reference: `~/code/zed/crates/gpui/src/app/entity_map.rs`

---

#### Issue 2: Element Trait ✅ COMPLETE
**Title:** Implement 3-phase Element lifecycle in WGPUI
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:** Replace Component trait with GPUI-style Element trait with request_layout -> prepaint -> paint phases.

Files created:
- `crates/wgpui/src/element/mod.rs` ✅
- `crates/wgpui/src/element/element.rs` - Element trait ✅
- `crates/wgpui/src/element/into_element.rs` - IntoElement trait ✅
- `crates/wgpui/src/element/render.rs` - Render and RenderOnce traits ✅
- `crates/wgpui/src/element/any_element.rs` - Type-erased element ✅
- `crates/wgpui/src/element/drawable.rs` - Draw phase wrapper ✅

Keep existing Component trait for backward compat, wrap in ComponentElement<C>. ✅

Reference: `~/code/zed/crates/gpui/src/element.rs`

---

#### Issue 3: Window Abstraction ✅ COMPLETE
**Title:** Implement Window struct with layout engine integration
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:** Centralize window management, layout computation, focus, and rendering.

Files created:
- `crates/wgpui/src/window/mod.rs`
- `crates/wgpui/src/window/window.rs` - Window struct
- `crates/wgpui/src/window/window_handle.rs` - External reference
- `crates/wgpui/src/window/invalidator.rs` - Dirty tracking
- `crates/wgpui/src/window/dispatch.rs` - Event dispatch tree

Integrate existing LayoutEngine (Taffy) with Window.

---

#### Issue 4: Styled Trait ✅ COMPLETE
**Title:** Implement fluent styling DSL in WGPUI
**Priority:** High
**Status:** Complete (2025-12-24)
**Description:** Add Styled trait enabling div().flex().w_full().bg(color) pattern.

Files created:
- `crates/wgpui/src/styled/mod.rs` ✅
- `crates/wgpui/src/styled/style.rs` - Style struct ✅
- `crates/wgpui/src/styled/styled.rs` - Styled trait with methods ✅
- `crates/wgpui/src/styled/refinement.rs` - StyleRefinement ✅
- `crates/wgpui/src/styled/helpers.rs` - px(), pct() helpers ✅

Implemented on Div, Text, Button ✅

---

#### Issue 5: Async Support ✅ COMPLETE
**Title:** Add cx.spawn() async task support to WGPUI
**Priority:** High
**Status:** Complete (2025-12-24)
**Description:** Enable async operations from within views with Task<T> handles.

Files to create:
- `crates/wgpui/src/async/mod.rs` ✅
- `crates/wgpui/src/async/task.rs` - Task<T> wrapper ✅
- `crates/wgpui/src/async/executor.rs` - Foreground/background executors ✅

Add cx.spawn() to Context<T>. ✅

---

#### Issue 6: Focus System ✅ COMPLETE
**Title:** Implement focus management in WGPUI
**Priority:** Medium
**Status:** Complete (2025-12-25)
**Description:** Add FocusHandle, focus chain, tab navigation, and EventContext helpers.

Files to create:
- `crates/wgpui/src/focus/mod.rs`
- `crates/wgpui/src/focus/focus_handle.rs`
- `crates/wgpui/src/focus/focus_chain.rs`

Integrated into `crates/wgpui/src/components/context.rs` for focus registration and tab navigation.

---

### Delete Web Stack (Phase 2)

#### Issue 7: Archive Maud UI Crate ✅ COMPLETE
**Title:** Move crates/ui to backroom archive
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:**
```bash
mkdir -p ~/code/backroom/openagents-maud-archive/crates
mv crates/ui ~/code/backroom/openagents-maud-archive/crates/
```
Removed from workspace Cargo.toml ✅

---

#### Issue 8: Archive Storybook ✅ COMPLETE
**Title:** Move crates/storybook to backroom archive
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:**
```bash
mv crates/storybook ~/code/backroom/openagents-maud-archive/crates/
```
Removed from workspace Cargo.toml ✅

---

#### Issue 9: Archive Old Autopilot-GUI ✅ COMPLETE
**Title:** Move crates/autopilot-gui to backroom archive
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:**
```bash
mv crates/autopilot-gui ~/code/backroom/openagents-maud-archive/crates/
```
Will be rebuilt as WGPUI native. ✅

---

#### Issue 10: Remove Web Dependencies ✅ COMPLETE
**Title:** Remove maud, actix-web, wry, tao from workspace
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:** Clean up Cargo.toml:
- Remove maud from [workspace.dependencies] ✅
- Remove actix-web from [workspace.dependencies] ✅
- Remove wry from [workspace.dependencies] ✅
- Remove tao from [workspace.dependencies] ✅
- Remove actix-ws ✅
- Update any crates that imported these ✅

---

#### Issue 11: Update Documentation ✅ COMPLETE
**Title:** Remove Maud/HTMX references from docs
**Priority:** High
**Status:** Complete (2025-12-24)
**Description:** Update these files:
- AGENTS.md - Remove "wry/tao + Actix + Maud" architecture references ✅
- SYNTHESIS.md - Update Part Eleven: User Interface Architecture ✅
- README.md - Update UI stack description ✅

---

### Autopilot-GUI Native (Phase 3)

#### Issue 12: Create New Autopilot-GUI Crate ✅ COMPLETE
**Title:** Create new WGPUI-native autopilot-gui crate
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:** Created fresh `crates/autopilot-gui` with wgpui/winit/wgpu and a winit event loop (`src/main.rs`) wired to the WGPUI shell (`src/app.rs`).

---

#### Issue 13: App State Structure ✅ COMPLETE
**Title:** Implement AutopilotApp state container
**Priority:** Urgent
**Status:** Complete (2025-12-24)
**Description:** Implemented `src/state/mod.rs` with `AppState` (summary, sessions, log lines, agents) and wired backend events over channels.

---

#### Issue 14: Navigation Component (N/A)
**Title:** Create NavBar and navigation routing
**Priority:** High
**Status:** N/A (2025-12-24)
**Description:** Superseded by fixed 4-pane layout (Dashboard, Chat, Context, Parallel) in `src/app.rs`.

---

#### Issue 15: Dashboard View ✅ COMPLETE
**Title:** Implement Dashboard view
**Priority:** High
**Status:** Complete (2025-12-24)
**Description:** Implemented `src/views/dashboard.rs` to render summary stats and recent sessions.

---

#### Issue 16: Chat View ✅ COMPLETE
**Title:** Implement Chat view with streaming
**Priority:** High
**Status:** Complete (2025-12-24)
**Description:** Implemented `src/views/chat.rs` to render streaming rlog lines via backend channel updates.

---

#### Issue 17: Permission Dialog (Skipped)
**Title:** Implement permission dialog modal
**Priority:** High
**Status:** Skipped (2025-12-24)
**Description:** Auto-approved permissions for Phase 3; no modal.

---

#### Issue 18: Context View ✅ COMPLETE
**Title:** Implement Context inspector view
**Priority:** Medium
**Status:** Complete (2025-12-24)
**Description:** Implemented `src/views/context.rs` to show active session id and log path.

---

#### Issue 19: Permissions View (Skipped)
**Title:** Implement Permissions manager view
**Priority:** Medium
**Status:** Skipped (2025-12-24)
**Description:** Auto-approved permissions for Phase 3; no permissions view.

---

#### Issue 20: Parallel Agents View ✅ COMPLETE
**Title:** Implement Parallel agents view
**Priority:** Medium
**Status:** Complete (2025-12-24)
**Description:** Implemented `src/views/parallel.rs` to show agent list and status.

---

#### Issue 21: Backend Integration ✅ COMPLETE
**Title:** Wire up in-process backend
**Priority:** High
**Status:** Complete (2025-12-24)
**Description:** Implemented `src/backend/mod.rs` to poll metrics DB, logs, and parallel agents, sending updates via channels to the UI.

---

### Component Parity (Phase 4)

#### Issue 22: ACP Component Parity ✅ COMPLETE
**Title:** Verify ACP components from the old ui crate are in WGPUI
**Priority:** Medium
**Status:** Complete (2025-12-25)
**Description:** ACP atoms/molecules/organisms are already present under `crates/wgpui/src/components/{atoms,molecules,organisms}` (tool_icon, tool_status_badge, streaming_indicator, thinking_toggle, permission_button, model_badge, mode_badge, keybinding_hint, feedback_button, entry_marker, content_type_icon, checkpoint_badge; message_header, entry_actions, diff_header, checkpoint_restore, permission_bar, model_selector, mode_selector, thinking_block, terminal_header, tool_header; assistant_message, user_message, thread_entry, thread_controls, tool_call_card, terminal_tool_call, search_tool_call, diff_tool_call, permission_dialog).

Recorder components are deferred pending a new direction.

---

#### Issue 23: WGPUI ACP Storybook Example ✅ COMPLETE
**Title:** Create WGPUI ACP component showcase example
**Priority:** Medium
**Status:** Complete (2025-12-25)
**Description:** Create `crates/wgpui/examples/storybook.rs`:
- Component gallery with navigation
- ACP atoms, molecules, organisms displayed
- Interactive demos (focus/keyboard, tool cards, streaming indicator)

Run with: `cargo run -p wgpui --example storybook --features desktop`

---

#### Issue 24: Update Autopilot UI Renderer (Deferred)
**Title:** Update autopilot ui_renderer to use WGPUI
**Priority:** High
**Status:** Deferred (2025-12-25)
**Description:** `crates/autopilot/src/ui_renderer.rs` still targets Maud/recorder HTML. Defer until recorder approach is decided; rework to ACP/WGPUI when we choose the new direction.

---

## Dependencies

**Add to wgpui:**
- slotmap (entity storage)
- derive_more (Deref derives)

**Remove from workspace:**
- maud
- actix-web
- actix-ws
- wry
- tao

## Testing Strategy

1. Unit tests for Entity system (notify/observe/subscribe)
2. Unit tests for Element lifecycle phases
3. Visual tests via storybook example
4. Integration test: autopilot-gui launches and renders

## Notes

- Reference: Zed GPUI at ~/code/zed/crates/gpui/
- Reference: Previous WGPUI work at ~/code/backroom/archive/openagents/coder/
- Keep existing WGPUI Component trait for backward compat during migration
- No border radius (sharp corners per design spec)
- Vera Mono font only
- Zed focus uses a FocusMap-backed FocusHandle and TabStopMap (tab_index + tab_stop + grouping). Our FocusChain is a simplified version; if we need parity, add tab groups and focus-handle lifecycle tracking.
- Zed prepaint assigns focus and hitboxes during the prepaint phase, and Window tracks focus paths for focus-in/out events.
- Zed AnyView supports cached rendering with StyleRefinement; consider adding a cache path if WGPUI performance becomes a bottleneck.

## Related Directives

- **d-020** - WGPUI Integration (superseded by this directive)
- **d-023** - WGPUI Overview (framework docs)
- **d-024** - Arwes Parity (completed, animations ready)
