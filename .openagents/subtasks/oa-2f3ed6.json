{
  "taskId": "oa-2f3ed6",
  "taskTitle": "Orchestrator cleanup commit should not include failed work",
  "subtasks": [
    {
      "id": "oa-2f3ed6-sub-001",
      "description": "Implement: Orchestrator cleanup commit should not include failed work\n\n## Bug Description\n\nThe orchestrator's final cleanup commit does `git add -A` which commits ALL files, not just progress files. This bypasses the per-task commit guardrail.\n\n## What Happened\n\n1. Claude Code wrote files with TypeScript errors (emit.test.ts missing required Task fields)\n2. Orchestrator verification correctly failed and marked subtask as FAILED\n3. Per-task commit was correctly skipped (\"no meaningful work done\")\n4. **BUG**: Final cleanup commit did `git add -A && git commit` - pushing broken code!\n5. Subsequent runs failed at init script because broken code is now on disk AND committed\n\n## Root Cause\n\n```javascript\n// In overnight.ts - cleanup at end of loop\nexecSync(\"git add -A\", { cwd: config.workDir });\nexecSync(`git commit -m \"chore: update progress files and logs...\"`, ...);\n```\n\nThis adds ALL files, not just progress files.\n\n## Solutions\n\n### Option A: Selective add\nOnly add specific paths:\n```javascript\nexecSync(\"git add .openagents/progress.md docs/logs/\", { cwd });\n```\n\n### Option B: Revert on failure\nAfter a failed subtask, run `git checkout -- .` to discard uncommitted changes.\n\n### Option C: Run typecheck before cleanup commit\nBefore committing, run typecheck. If it fails, skip the commit.\n\n## Recommended\n\nOption B (revert on failure) is cleanest - failed work should never persist.",
      "status": "done",
      "startedAt": "2025-12-03T16:56:31.196Z",
      "claudeCode": {
        "sessionId": "d4668bb6-edb4-4260-bb08-066e810cff38"
      },
      "completedAt": "2025-12-03T17:00:27.389Z"
    },
    {
      "id": "oa-2f3ed6-sub-002",
      "description": "Add tests for: Orchestrator cleanup commit should not include failed work\n\nVerify the implementation works correctly with unit tests.",
      "status": "done",
      "startedAt": "2025-12-03T17:00:27.389Z",
      "claudeCode": {
        "sessionId": "d307ad6d-7d23-4da4-8416-8a020bd9feb5"
      },
      "completedAt": "2025-12-03T17:01:56.770Z"
    },
    {
      "id": "oa-2f3ed6-sub-003",
      "description": "Document: Orchestrator cleanup commit should not include failed work\n\nAdd appropriate documentation/comments.",
      "status": "done",
      "startedAt": "2025-12-03T17:01:56.771Z",
      "claudeCode": {
        "sessionId": "04688edf-4448-4e36-8a86-bebb92f34219"
      },
      "completedAt": "2025-12-03T17:04:39.611Z"
    }
  ],
  "createdAt": "2025-12-03T16:56:31.196Z",
  "updatedAt": "2025-12-03T16:56:31.196Z"
}