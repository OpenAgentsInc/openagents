{
  "taskId": "oa-6c74e7",
  "taskTitle": "Add tests for HUD protocol and client",
  "subtasks": [
    {
      "id": "oa-6c74e7-fix-typecheck",
      "description": "## CRITICAL: Fix Typecheck Errors First\n\nThe codebase has typecheck errors that MUST be fixed before any other work can proceed.\n\nRun `bun run typecheck` to see the errors, then fix them.\n\nCommon causes:\n- Unused imports or variables (TS6133)\n- Type mismatches (TS2322)\n- Missing or extra arguments (TS2554)\n\nAfter fixing, verify with `bun run typecheck` that it passes before proceeding.",
      "status": "done",
      "startedAt": "2025-12-03T08:31:08.599Z",
      "claudeCode": {
        "sessionId": "67453408-b43b-4a89-8358-27d0870e1823"
      },
      "completedAt": "2025-12-03T08:32:49.219Z"
    },
    {
      "id": "oa-6c74e7-sub-001",
      "description": "Implement: Add tests for HUD protocol and client\n\nAdd unit and integration tests for HUD protocol and client.\n\n## Files\n- src/hud/protocol.test.ts\n- src/hud/client.test.ts\n\n## Protocol Tests (protocol.test.ts)\n```typescript\nimport { test, expect } from \"bun:test\";\nimport { mapOrchestratorEvent } from \"./protocol.js\";\n\ntest(\"mapOrchestratorEvent converts task_selected\", () => {\n  const event = { type: \"task_selected\", task: { id: \"t1\", title: \"Test\" } };\n  const msg = mapOrchestratorEvent(event);\n  expect(msg.type).toBe(\"task_selected\");\n  expect(msg.taskId).toBe(\"t1\");\n  expect(msg.ts).toBeDefined();\n});\n\n// Test all event types map correctly\n// Test ts field is always present\n// Test unknown events throw or return error type\n```\n\n## Client Tests (client.test.ts)\n```typescript\nimport { test, expect } from \"bun:test\";\nimport { HudClient } from \"./client.js\";\n\ntest(\"HudClient queues messages when disconnected\", () => {\n  const client = new HudClient();\n  // Don't connect\n  client.send({ type: \"text\", text: \"hello\", ts: new Date().toISOString() });\n  // Verify message is queued (may need to expose queue for testing)\n});\n\ntest(\"HudClient flushes queue on connect\", async () => {\n  // Requires mock WebSocket server\n  // Start test server, connect client, verify queued messages arrive\n});\n\ntest(\"HudClient reconnects on disconnect\", async () => {\n  // Start server, connect, kill server, restart, verify reconnect\n});\n\ntest(\"HudClient silently fails when server unavailable\", () => {\n  const client = new HudClient();\n  // Should not throw\n  expect(() => client.connect()).not.toThrow();\n});\n```\n\n## Integration Test (optional)\n- Start HUD server\n- Create HudClient, connect\n- Send messages, verify server receives\n- Disconnect, reconnect, verify queue flushed\n\n## Reference\n- Use bun:test\n- See existing test patterns in src/**/*.test.ts",
      "status": "done",
      "startedAt": "2025-12-03T08:32:49.219Z",
      "claudeCode": {
        "sessionId": "a313576d-08ac-4620-a601-0b07cd05858e"
      },
      "completedAt": "2025-12-03T08:33:22.766Z"
    }
  ],
  "createdAt": "2025-12-03T08:14:49.796Z",
  "updatedAt": "2025-12-03T08:31:08.599Z"
}