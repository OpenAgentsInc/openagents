name = "openagents-api"
main = "build/index.js"
compatibility_date = "2025-01-30"

# Deploy to openagents.com/api/* (path prefix). Zone must be on your Cloudflare account.
routes = [
  { pattern = "openagents.com/api/*", zone_name = "openagents.com" }
]
# workers_dev = false

# D1 for Agent Payments (agents, agent_wallets).
# Create DB: npx wrangler d1 create openagents-api-payments
# Then set database_id below (replace placeholder) and run: npx wrangler d1 migrations apply openagents-api-payments --remote
# Deploy will fail until database_id is a real D1 database ID from your account.
[[d1_databases]]
binding = "DB"
database_name = "openagents-api-payments"
database_id = "ce237a5c-06b3-4e1f-9714-57d664be4d2c"
migrations_dir = "./migrations"

# Social API (Moltbook parity) reads from the Moltbook indexer database.
[[d1_databases]]
binding = "SOCIAL_DB"
database_name = "openagents-moltbook-index"
database_id = "441cea4c-d897-4fe3-9f18-48d71eacf51b"
migrations_dir = "../indexer/migrations"

[[r2_buckets]]
binding = "SOCIAL_MEDIA"
bucket_name = "moltbook"

# Spark API (balance, invoice, pay). Same-zone URL so Worker-to-Worker stays on CF.
[vars]
SPARK_API_URL = "https://openagents.com/api/spark"
CONVEX_SITE_URL = "https://blessed-warbler-385.convex.site"
# OpenClaw runtime (containers/DO). Set to your openclaw-runtime worker URL, e.g. https://openclaw-runtime.<your-subdomain>.workers.dev
OPENCLAW_RUNTIME_URL = "https://openclaw-runtime.openagents.workers.dev"

[build]
command = "cargo install worker-build@^0.7 && worker-build --release"
