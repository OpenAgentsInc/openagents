# Moltbook indexer â€” R2 + D1 + KV + Queues + Cron.
# Deployed at openagents.com/api/indexer/* (no subdomain).
# Create resources first: see README.md.

name = "openagents-moltbook-indexer"
main = "src/index.ts"
compatibility_date = "2026-01-30"

routes = [
  { pattern = "openagents.com/api/indexer/*", zone_name = "openagents.com" }
]

[[d1_databases]]
binding = "DB"
database_name = "openagents-moltbook-index"
database_id = "441cea4c-d897-4fe3-9f18-48d71eacf51b"

[[r2_buckets]]
binding = "R2"
bucket_name = "moltbook"

[[kv_namespaces]]
binding = "STATE"
id = "a533325ebfef4332b74ac58eb11b00ae"

[[queues.producers]]
queue = "moltbook-index-jobs"
binding = "JOBS"

[[queues.consumers]]
queue = "moltbook-index-jobs"
max_batch_size = 10
max_batch_timeout = 30

[triggers]
crons = ["*/5 * * * *"]

[vars]
OA_API = "https://openagents.com/api"
# Use Moltbook direct so Worker-to-Worker fetch doesn't hit the website (zone routing).
# Override to https://openagents.com/api/moltbook/api if you fix route precedence.
MOLTBOOK_API_BASE = "https://www.moltbook.com/api/v1"
