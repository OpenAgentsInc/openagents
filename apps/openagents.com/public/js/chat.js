function p(r){this.content=r}p.prototype={constructor:p,find:function(r){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===r)return t;return-1},get:function(r){var t=this.find(r);return t==-1?void 0:this.content[t+1]},update:function(r,t,e){var n=e&&e!=r?this.remove(e):this,i=n.find(r),s=n.content.slice();return i==-1?s.push(e||r,t):(s[i+1]=t,e&&(s[i]=e)),new p(s)},remove:function(r){var t=this.find(r);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new p(e)},addToStart:function(r,t){return new p([r,t].concat(this.remove(r).content))},addToEnd:function(r,t){var e=this.remove(r).content.slice();return e.push(r,t),new p(e)},addBefore:function(r,t,e){var n=this.remove(t),i=n.content.slice(),s=n.find(r);return i.splice(s==-1?i.length:s,0,t,e),new p(i)},forEach:function(r){for(var t=0;t<this.content.length;t+=2)r(this.content[t],this.content[t+1])},prepend:function(r){return r=p.from(r),r.size?new p(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=p.from(r),r.size?new p(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var t=this;r=p.from(r);for(var e=0;e<r.content.length;e+=2)t=t.remove(r.content[e]);return t},toObject:function(){var r={};return this.forEach(function(t,e){r[t]=e}),r},get size(){return this.content.length>>1}};p.from=function(r){if(r instanceof p)return r;var t=[];if(r)for(var e in r)t.push(e,r[e]);return new p(t)};function B(r,t,e){for(let n=0;;n++){if(n==r.childCount||n==t.childCount)return r.childCount==t.childCount?null:e;let i=r.child(n),s=t.child(n);if(i==s){e+=i.nodeSize;continue}if(!i.sameMarkup(s))return e;if(i.isText&&i.text!=s.text){for(let l=0;i.text[l]==s.text[l];l++)e++;return e}if(i.content.size||s.content.size){let l=B(i.content,s.content,e+1);if(l!=null)return l}e+=i.nodeSize}}function q(r,t,e,n){for(let i=r.childCount,s=t.childCount;;){if(i==0||s==0)return i==s?null:{a:e,b:n};let l=r.child(--i),o=t.child(--s),h=l.nodeSize;if(l==o){e-=h,n-=h;continue}if(!l.sameMarkup(o))return{a:e,b:n};if(l.isText&&l.text!=o.text){let u=0,c=Math.min(l.text.length,o.text.length);for(;u<c&&l.text[l.text.length-u-1]==o.text[o.text.length-u-1];)u++,e--,n--;return{a:e,b:n}}if(l.content.size||o.content.size){let u=q(l.content,o.content,e-1,n-1);if(u)return u}e-=h,n-=h}}class a{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,i=0,s){for(let l=0,o=0;o<e;l++){let h=this.content[l],u=o+h.nodeSize;if(u>t&&n(h,i+o,s||null,l)!==!1&&h.content.size){let c=o+1;h.nodesBetween(Math.max(0,t-c),Math.min(h.content.size,e-c),n,i+c)}o=u}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,i){let s="",l=!0;return this.nodesBetween(t,e,(o,h)=>{let u=o.isText?o.text.slice(Math.max(t,h)-h,e-h):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&u||o.isTextblock)&&n&&(l?l=!1:s+=n),s+=u},0),s}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,i=this.content.slice(),s=0;for(e.isText&&e.sameMarkup(n)&&(i[i.length-1]=e.withText(e.text+n.text),s=1);s<t.content.length;s++)i.push(t.content[s]);return new a(i,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],i=0;if(e>t)for(let s=0,l=0;l<e;s++){let o=this.content[s],h=l+o.nodeSize;h>t&&((l<t||h>e)&&(o.isText?o=o.cut(Math.max(0,t-l),Math.min(o.text.length,e-l)):o=o.cut(Math.max(0,t-l-1),Math.min(o.content.size,e-l-1))),n.push(o),i+=o.nodeSize),l=h}return new a(n,i)}cutByIndex(t,e){return t==e?a.empty:t==0&&e==this.content.length?this:new a(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let i=this.content.slice(),s=this.size+e.nodeSize-n.nodeSize;return i[t]=e,new a(i,s)}addToStart(t){return new a([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new a(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let i=this.content[e];t(i,n,e),n+=i.nodeSize}}findDiffStart(t,e=0){return B(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return q(this,t,e,n)}findIndex(t,e=-1){if(t==0)return S(0,t);if(t==this.size)return S(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,i=0;;n++){let s=this.child(n),l=i+s.nodeSize;if(l>=t)return l==t||e>0?S(n+1,l):S(n,i);i=l}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return a.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new a(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return a.empty;let e,n=0;for(let i=0;i<t.length;i++){let s=t[i];n+=s.nodeSize,i&&s.isText&&t[i-1].sameMarkup(s)?(e||(e=t.slice(0,i)),e[e.length-1]=s.withText(e[e.length-1].text+s.text)):e&&e.push(s)}return new a(e||t,n)}static from(t){if(!t)return a.empty;if(t instanceof a)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new a([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}a.empty=new a([],0);const z={index:0,offset:0};function S(r,t){return z.index=r,z.offset=t,z}function E(r,t){if(r===t)return!0;if(!(r&&typeof r=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(r);if(Array.isArray(t)!=e)return!1;if(e){if(r.length!=t.length)return!1;for(let n=0;n<r.length;n++)if(!E(r[n],t[n]))return!1}else{for(let n in r)if(!(n in t)||!E(r[n],t[n]))return!1;for(let n in t)if(!(n in r))return!1}return!0}class f{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let i=0;i<t.length;i++){let s=t[i];if(this.eq(s))return t;if(this.type.excludes(s.type))e||(e=t.slice(0,i));else{if(s.type.excludes(this.type))return t;!n&&s.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),n=!0),e&&e.push(s)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&E(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);let i=n.create(e.attrs);return n.checkAttrs(i.attrs),i}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return f.none;if(t instanceof f)return[t];let e=t.slice();return e.sort((n,i)=>n.type.rank-i.type.rank),e}}f.none=[];class T extends Error{}class d{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=j(this.content,t+this.openStart,e);return n&&new d(n,this.openStart,this.openEnd)}removeBetween(t,e){return new d(F(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return d.empty;let n=e.openStart||0,i=e.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new d(a.fromJSON(t,e.content),n,i)}static maxOpen(t,e=!0){let n=0,i=0;for(let s=t.firstChild;s&&!s.isLeaf&&(e||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=t.lastChild;s&&!s.isLeaf&&(e||!s.type.spec.isolating);s=s.lastChild)i++;return new d(t,n,i)}}d.empty=new d(a.empty,0,0);function F(r,t,e){let{index:n,offset:i}=r.findIndex(t),s=r.maybeChild(n),{index:l,offset:o}=r.findIndex(e);if(i==t||s.isText){if(o!=e&&!r.child(l).isText)throw new RangeError("Removing non-flat range");return r.cut(0,t).append(r.cut(e))}if(n!=l)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(F(s.content,t-i-1,e-i-1)))}function j(r,t,e,n){let{index:i,offset:s}=r.findIndex(t),l=r.maybeChild(i);if(s==t||l.isText)return r.cut(0,t).append(e).append(r.cut(t));let o=j(l.content,t-s-1,e);return o&&r.replaceChild(i,l.copy(o))}function Z(r,t,e){if(e.openStart>r.depth)throw new T("Inserted content deeper than insertion position");if(r.depth-e.openStart!=t.depth-e.openEnd)throw new T("Inconsistent open depths");return L(r,t,e,0)}function L(r,t,e,n){let i=r.index(n),s=r.node(n);if(i==t.index(n)&&n<r.depth-e.openStart){let l=L(r,t,e,n+1);return s.copy(s.content.replaceChild(i,l))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&r.depth==n&&t.depth==n){let l=r.parent,o=l.content;return y(l,o.cut(0,r.parentOffset).append(e.content).append(o.cut(t.parentOffset)))}else{let{start:l,end:o}=K(e,r);return y(s,U(r,l,o,t,n))}else return y(s,v(r,t,n))}function W(r,t){if(!t.type.compatibleContent(r.type))throw new T("Cannot join "+t.type.name+" onto "+r.type.name)}function M(r,t,e){let n=r.node(e);return W(n,t.node(e)),n}function g(r,t){let e=t.length-1;e>=0&&r.isText&&r.sameMarkup(t[e])?t[e]=r.withText(t[e].text+r.text):t.push(r)}function w(r,t,e,n){let i=(t||r).node(e),s=0,l=t?t.index(e):i.childCount;r&&(s=r.index(e),r.depth>e?s++:r.textOffset&&(g(r.nodeAfter,n),s++));for(let o=s;o<l;o++)g(i.child(o),n);t&&t.depth==e&&t.textOffset&&g(t.nodeBefore,n)}function y(r,t){return r.type.checkContent(t),r.copy(t)}function U(r,t,e,n,i){let s=r.depth>i&&M(r,t,i+1),l=n.depth>i&&M(e,n,i+1),o=[];return w(null,r,i,o),s&&l&&t.index(i)==e.index(i)?(W(s,l),g(y(s,U(r,t,e,n,i+1)),o)):(s&&g(y(s,v(r,t,i+1)),o),w(t,e,i,o),l&&g(y(l,v(e,n,i+1)),o)),w(n,null,i,o),new a(o)}function v(r,t,e){let n=[];if(w(null,r,e,n),r.depth>e){let i=M(r,t,e+1);g(y(i,v(r,t,e+1)),n)}return w(t,null,e,n),new a(n)}function K(r,t){let e=t.depth-r.openStart,i=t.node(e).copy(r.content);for(let s=e-1;s>=0;s--)i=t.node(s).copy(a.from(i));return{start:i.resolveNoCache(r.openStart+e),end:i.resolveNoCache(i.content.size-r.openEnd-e)}}class k{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=t.child(e);return n?t.child(e).cut(n):i}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[e*3],i=e==0?0:this.path[e*3-1]+1;for(let s=0;s<t;s++)i+=n.child(s).nodeSize;return i}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return f.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),i=t.maybeChild(e);if(!n){let o=n;n=i,i=o}let s=n.marks;for(var l=0;l<s.length;l++)s[l].type.spec.inclusive===!1&&(!i||!s[l].isInSet(i.marks))&&(s=s[l--].removeFromSet(s));return s}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,i=t.parent.maybeChild(t.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new tt(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],i=0,s=e;for(let l=t;;){let{index:o,offset:h}=l.content.findIndex(s),u=s-h;if(n.push(l,o,i+h),!u||(l=l.child(o),l.isText))break;s=u-1,i+=h+1}return new k(e,n,s)}static resolveCached(t,e){let n=N.get(t);if(n)for(let s=0;s<n.elts.length;s++){let l=n.elts[s];if(l.pos==e)return l}else N.set(t,n=new _);let i=n.elts[n.i]=k.resolve(t,e);return n.i=(n.i+1)%$,i}}class _{constructor(){this.elts=[],this.i=0}}const $=12,N=new WeakMap;class tt{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const et=Object.create(null);class x{constructor(t,e,n,i=f.none){this.type=t,this.attrs=e,this.marks=i,this.content=n||a.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,i=0){this.content.nodesBetween(t,e,n,i,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,i){return this.content.textBetween(t,e,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&E(this.attrs,e||t.defaultAttrs||et)&&f.sameSet(this.marks,n||f.none)}copy(t=null){return t==this.content?this:new x(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new x(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return d.empty;let i=this.resolve(t),s=this.resolve(e),l=n?0:i.sharedDepth(e),o=i.start(l),u=i.node(l).content.cut(i.pos-o,s.pos-o);return new d(u,i.depth-l,s.depth-l)}replace(t,e,n){return Z(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:i}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(i==t||e.isText)return e;t-=i+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let i=this.content.child(e-1);return{node:i,index:e-1,offset:n-i.nodeSize}}resolve(t){return k.resolveCached(this,t)}resolveNoCache(t){return k.resolve(this,t)}rangeHasMark(t,e,n){let i=!1;return e>t&&this.nodesBetween(t,e,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),P(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=a.empty,i=0,s=n.childCount){let l=this.contentMatchAt(t).matchFragment(n,i,s),o=l&&l.matchFragment(this.content,e);if(!o||!o.validEnd)return!1;for(let h=i;h<s;h++)if(!this.type.allowsMarks(n.child(h).marks))return!1;return!0}canReplaceWith(t,e,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(t).matchType(n),l=s&&s.matchFragment(this.content,e);return l?l.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=f.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!f.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let i=a.fromJSON(t,e.content),s=t.nodeType(e.type).create(e.attrs,i,n);return s.type.checkAttrs(s.attrs),s}}x.prototype.text=void 0;class C extends x{constructor(t,e,n,i){if(super(t,e,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):P(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new C(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new C(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function P(r,t){for(let e=r.length-1;e>=0;e--)t=r[e].type.name+"("+t+")";return t}class m{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new nt(t,e);if(n.next==null)return m.empty;let i=G(n);n.next&&n.err("Unexpected trailing text");let s=ut(ht(i));return at(s,n),s}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let i=this;for(let s=e;i&&s<n;s++)i=i.matchType(t.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let i=[this];function s(l,o){let h=l.matchFragment(t,n);if(h&&(!e||h.validEnd))return a.from(o.map(u=>u.createAndFill()));for(let u=0;u<l.next.length;u++){let{type:c,next:O}=l.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(O)==-1){i.push(O);let R=s(O,o.concat(c));if(R)return R}}return null}return s(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(t)){let l=[];for(let o=i;o.type;o=o.via)l.push(o.type);return l.reverse()}for(let l=0;l<s.next.length;l++){let{type:o,next:h}=s.next[l];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in e)&&(!i.type||h.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),e[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let i=0;i<n.next.length;i++)t.indexOf(n.next[i].next)==-1&&e(n.next[i].next)}return e(this),t.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let l=0;l<n.next.length;l++)s+=(l?", ":"")+n.next[l].type.name+"->"+t.indexOf(n.next[l].next);return s}).join(`
`)}}m.empty=new m(!0);class nt{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function G(r){let t=[];do t.push(it(r));while(r.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function it(r){let t=[];do t.push(rt(r));while(r.next&&r.next!=")"&&r.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function rt(r){let t=ot(r);for(;;)if(r.eat("+"))t={type:"plus",expr:t};else if(r.eat("*"))t={type:"star",expr:t};else if(r.eat("?"))t={type:"opt",expr:t};else if(r.eat("{"))t=st(r,t);else break;return t}function I(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let t=Number(r.next);return r.pos++,t}function st(r,t){let e=I(r),n=e;return r.eat(",")&&(r.next!="}"?n=I(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function lt(r,t){let e=r.nodeTypes,n=e[t];if(n)return[n];let i=[];for(let s in e){let l=e[s];l.isInGroup(t)&&i.push(l)}return i.length==0&&r.err("No node type or group '"+t+"' found"),i}function ot(r){if(r.eat("(")){let t=G(r);return r.eat(")")||r.err("Missing closing paren"),t}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let t=lt(r,r.next).map(e=>(r.inline==null?r.inline=e.isInline:r.inline!=e.isInline&&r.err("Mixing inline and block content"),{type:"name",value:e}));return r.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function ht(r){let t=[[]];return i(s(r,0),e()),t;function e(){return t.push([])-1}function n(l,o,h){let u={term:h,to:o};return t[l].push(u),u}function i(l,o){l.forEach(h=>h.to=o)}function s(l,o){if(l.type=="choice")return l.exprs.reduce((h,u)=>h.concat(s(u,o)),[]);if(l.type=="seq")for(let h=0;;h++){let u=s(l.exprs[h],o);if(h==l.exprs.length-1)return u;i(u,o=e())}else if(l.type=="star"){let h=e();return n(o,h),i(s(l.expr,h),h),[n(h)]}else if(l.type=="plus"){let h=e();return i(s(l.expr,o),h),i(s(l.expr,h),h),[n(h)]}else{if(l.type=="opt")return[n(o)].concat(s(l.expr,o));if(l.type=="range"){let h=o;for(let u=0;u<l.min;u++){let c=e();i(s(l.expr,h),c),h=c}if(l.max==-1)i(s(l.expr,h),h);else for(let u=l.min;u<l.max;u++){let c=e();n(h,c),i(s(l.expr,h),c),h=c}return[n(h)]}else{if(l.type=="name")return[n(o,void 0,l.value)];throw new Error("Unknown expr type")}}}}function H(r,t){return t-r}function J(r,t){let e=[];return n(t),e.sort(H);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);e.push(i);for(let l=0;l<s.length;l++){let{term:o,to:h}=s[l];!o&&e.indexOf(h)==-1&&n(h)}}}function ut(r){let t=Object.create(null);return e(J(r,0));function e(n){let i=[];n.forEach(l=>{r[l].forEach(({term:o,to:h})=>{if(!o)return;let u;for(let c=0;c<i.length;c++)i[c][0]==o&&(u=i[c][1]);J(r,h).forEach(c=>{u||i.push([o,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let s=t[n.join(",")]=new m(n.indexOf(r.length-1)>-1);for(let l=0;l<i.length;l++){let o=i[l][1].sort(H);s.next.push({type:i[l][0],next:t[o.join(",")]||e(o)})}return s}}function at(r,t){for(let e=0,n=[r];e<n.length;e++){let i=n[e],s=!i.validEnd,l=[];for(let o=0;o<i.next.length;o++){let{type:h,next:u}=i.next[o];l.push(h.name),s&&!(h.isText||h.hasRequiredAttrs())&&(s=!1),n.indexOf(u)==-1&&n.push(u)}s&&t.err("Only non-generatable nodes ("+l.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Q(r){let t=Object.create(null);for(let e in r){let n=r[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function V(r,t){let e=Object.create(null);for(let n in r){let i=t&&t[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=i}return e}function X(r,t,e,n){for(let i in t)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${e} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(t[i])}}function Y(r,t){let e=Object.create(null);if(t)for(let n in t)e[n]=new ft(r,n,t[n]);return e}class b{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Y(t,n.attrs),this.defaultAttrs=Q(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==m.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:V(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new x(this,this.computeAttrs(t),a.from(e),f.setFrom(n))}createChecked(t=null,e,n){return e=a.from(e),this.checkContent(e),new x(this,this.computeAttrs(t),e,f.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),e=a.from(e),e.size){let l=this.contentMatch.fillBefore(e);if(!l)return null;e=l.append(e)}let i=this.contentMatch.matchFragment(e),s=i&&i.fillBefore(a.empty,!0);return s?new x(this,t,e.append(s),f.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){X(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:f.none:t}static compile(t,e){let n=Object.create(null);t.forEach((s,l)=>n[s]=new b(s,e,l));let i=e.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}function ct(r,t,e){let n=e.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${t} on type ${r}, got ${s}`)}}class ft{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?ct(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class A{constructor(t,e,n,i){this.name=t,this.rank=e,this.schema=n,this.spec=i,this.attrs=Y(t,i.attrs),this.excluded=null;let s=Q(this.attrs);this.instance=s?new f(this,s):null}create(t=null){return!t&&this.instance?this.instance:new f(this,V(this.attrs,t))}static compile(t,e){let n=Object.create(null),i=0;return t.forEach((s,l)=>n[s]=new A(s,i++,e,l)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){X(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class pt{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let i in t)e[i]=t[i];e.nodes=p.from(t.nodes),e.marks=p.from(t.marks||{}),this.nodes=b.compile(this.spec.nodes,this),this.marks=A.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],l=s.spec.content||"",o=s.spec.marks;if(s.contentMatch=n[l]||(n[l]=m.parse(l,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=o=="_"?null:o?D(this,o.split(" ")):o==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],l=s.spec.excludes;s.excluded=l==null?[s]:l==""?[]:D(this,l.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,i){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof b){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,n,i)}text(t,e){let n=this.nodes.text;return new C(n,n.defaultAttrs,t,f.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return x.fromJSON(this,t)}markFromJSON(t){return f.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function D(r,t){let e=[];for(let n=0;n<t.length;n++){let i=t[n],s=r.marks[i],l=s;if(s)e.push(s);else for(let o in r.marks){let h=r.marks[o];(i=="_"||h.spec.group&&h.spec.group.split(" ").indexOf(i)>-1)&&e.push(l=h)}if(!l)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return e}new pt({nodes:{doc:{content:"paragraph+"},paragraph:{content:"inline*",group:"block",toDOM(){return["p",0]},parseDOM:[{tag:"p"}]},text:{group:"inline",inline:!0},hard_break:{inline:!0,group:"inline",selectable:!1,toDOM(){return["br"]},parseDOM:[{tag:"br"}]}}});async function dt(r){console.log("=== sendMessage Debug ==="),console.log("Message received (with escapes):",JSON.stringify(r)),console.log("Message received (raw):",r),console.log("Message length:",r.length),r.trim()&&document.getElementById("submit-button")}window.sendMessage=dt;
//# sourceMappingURL=chat.js.map
