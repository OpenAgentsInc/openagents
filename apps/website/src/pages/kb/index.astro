---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const articles = (await getCollection('kb')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Knowledge Base | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
		<style>
			.lede {
				color: var(--text-secondary);
				max-width: 70ch;
			}
			.grid {
				display: grid;
				grid-template-columns: 1fr;
				gap: 14px;
				margin-top: 1.5rem;
			}
			@media (min-width: 840px) {
				.grid {
					grid-template-columns: 1fr 1fr;
				}
			}
			.card {
				border: 1px solid var(--panel-border);
				background: var(--panel);
				border-radius: 14px;
				padding: 16px 16px;
				box-shadow: var(--box-shadow);
				text-decoration: none;
				display: block;
			}
			.card:hover {
				border-color: color-mix(in srgb, var(--accent) 55%, var(--panel-border));
				background: color-mix(in srgb, var(--panel) 92%, #ffffff 8%);
			}
			.title {
				margin: 0;
				font-size: 1.15rem;
				line-height: 1.25;
				color: var(--text-primary);
			}
			.meta {
				margin: 0.35rem 0 0.75rem 0;
				color: var(--text-muted);
				font-size: 0.95rem;
			}
			.desc {
				margin: 0;
				color: var(--text-secondary);
				font-size: 1rem;
				line-height: 1.55;
			}
			.tags {
				margin-top: 0.85rem;
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
			}
			.tag {
				font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
					"Courier New", monospace;
				font-size: 12px;
				padding: 4px 8px;
				border-radius: 999px;
				border: 1px solid var(--panel-border);
				color: var(--text-muted);
				background: color-mix(in srgb, var(--panel) 88%, #000000 12%);
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Knowledge Base</h1>
			<p class="lede">
				Short, durable explanations of the primitives OpenAgents cares about: identity, coordination,
				and settlement for autonomous agents. Written for humans and agents.
			</p>

			<div class="grid">
				{
					articles.map((a) => (
						<a class="card" href={`/kb/${a.id}/`}>
							<h2 class="title">{a.data.title}</h2>
							<p class="meta">
								<FormattedDate date={a.data.pubDate} />
							</p>
							<p class="desc">{a.data.description}</p>
							{a.data.tags?.length ? (
								<div class="tags">
									{a.data.tags.slice(0, 6).map((t) => (
										<span class="tag">{t}</span>
									))}
								</div>
							) : null}
						</a>
					))
				}
			</div>
		</main>
		<Footer />
	</body>
</html>

