# OpenAgents Wallet Worker - Cloudflare Workers configuration
# Deploy with: bun run deploy:wallet
#
# NOTE: This worker contains the spark/breez-sdk dependency which is ~5-6MB.
# It may exceed Cloudflare's 3MB free tier limit after optimization.
# Options if it exceeds 3MB:
#   1. Use Cloudflare paid plan (10MB limit)
#   2. Deploy to Fly.io instead (3GB limit)
#   3. Further optimize breez-sdk features

name = "openagents-wallet"
main = "wallet-worker/build/index.js"
compatibility_date = "2024-12-01"

# Worker build configuration
[build]
command = "cd wallet-worker && cargo install -q worker-build && CC_wasm32_unknown_unknown=/opt/homebrew/opt/llvm/bin/clang AR_wasm32_unknown_unknown=/opt/homebrew/opt/llvm/bin/llvm-ar worker-build --release"

# D1 Database (same as main worker)
[[d1_databases]]
binding = "DB"
database_name = "openagents"
database_id = "8ba16bce-6e9f-41ed-9bfb-3dee08050d65"

# KV Namespace for sessions (same as main worker)
[[kv_namespaces]]
binding = "SESSIONS"
id = "0aa10501fe834f84ad33672acf4ed741"

# Environment variables (non-secret)
[vars]
SPARK_NETWORK = "testnet"

# Secrets (set via: wrangler secret put <NAME> --config wrangler-wallet.toml)
# SESSION_SECRET (same as main worker - needed for identity decryption)
# BREEZ_API_KEY or SPARK_API_KEY

# Local development settings
[dev]
port = 8788
local_protocol = "http"
