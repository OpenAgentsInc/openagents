# syntax=docker/dockerfile:1

FROM rust:1-bookworm AS builder
WORKDIR /workspace

COPY . .

RUN cargo build --release --manifest-path apps/lightning-wallet-executor/Cargo.toml

FROM debian:bookworm-slim
WORKDIR /app

RUN apt-get update \
  && apt-get install -y --no-install-recommends ca-certificates \
  && rm -rf /var/lib/apt/lists/*

COPY --from=builder /workspace/target/release/lightning-wallet-executor /usr/local/bin/lightning-wallet-executor

ENV OA_LIGHTNING_WALLET_EXECUTOR_HOST=0.0.0.0
ENV OA_LIGHTNING_WALLET_EXECUTOR_PORT=8080

EXPOSE 8080

CMD ["lightning-wallet-executor", "serve"]
