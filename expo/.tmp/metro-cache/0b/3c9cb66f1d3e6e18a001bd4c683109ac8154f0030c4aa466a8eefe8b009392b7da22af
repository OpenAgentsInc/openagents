{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"invariant","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":13,"column":18},"end":{"line":13,"column":38}}],"key":"oQpL0Es3H146KnQH9ygFeHrzVP4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[0]);\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[1]);\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var invariant = require(_dependencyMap[2]);\n  var DEBUG = false;\n  var TaskQueue = /*#__PURE__*/function () {\n    function TaskQueue(_ref) {\n      var onMoreTasks = _ref.onMoreTasks;\n      (0, _classCallCheck.default)(this, TaskQueue);\n      this._onMoreTasks = onMoreTasks;\n      this._queueStack = [{\n        tasks: [],\n        popable: false\n      }];\n    }\n    return (0, _createClass.default)(TaskQueue, [{\n      key: \"enqueue\",\n      value: function enqueue(task) {\n        this._getCurrentQueue().push(task);\n      }\n    }, {\n      key: \"enqueueTasks\",\n      value: function enqueueTasks(tasks) {\n        tasks.forEach(task => this.enqueue(task));\n      }\n    }, {\n      key: \"cancelTasks\",\n      value: function cancelTasks(tasksToCancel) {\n        this._queueStack = this._queueStack.map(queue => ({\n          ...queue,\n          tasks: queue.tasks.filter(task => tasksToCancel.indexOf(task) === -1)\n        })).filter((queue, idx) => queue.tasks.length > 0 || idx === 0);\n      }\n    }, {\n      key: \"hasTasksToProcess\",\n      value: function hasTasksToProcess() {\n        return this._getCurrentQueue().length > 0;\n      }\n    }, {\n      key: \"processNext\",\n      value: function processNext() {\n        var queue = this._getCurrentQueue();\n        if (queue.length) {\n          var task = queue.shift();\n          try {\n            if (typeof task === 'object' && task.gen) {\n              DEBUG;\n              this._genPromise(task);\n            } else if (typeof task === 'object' && task.run) {\n              DEBUG;\n              task.run();\n            } else {\n              invariant(typeof task === 'function', 'Expected Function, SimpleTask, or PromiseTask, but got:\\n' + JSON.stringify(task, null, 2));\n              DEBUG;\n              task();\n            }\n          } catch (e) {\n            e.message = 'TaskQueue: Error with task ' + (task.name || '') + ': ' + e.message;\n            throw e;\n          }\n        }\n      }\n    }, {\n      key: \"_getCurrentQueue\",\n      value: function _getCurrentQueue() {\n        var stackIdx = this._queueStack.length - 1;\n        var queue = this._queueStack[stackIdx];\n        if (queue.popable && queue.tasks.length === 0 && this._queueStack.length > 1) {\n          this._queueStack.pop();\n          DEBUG;\n          return this._getCurrentQueue();\n        } else {\n          return queue.tasks;\n        }\n      }\n    }, {\n      key: \"_genPromise\",\n      value: function _genPromise(task) {\n        this._queueStack.push({\n          tasks: [],\n          popable: false\n        });\n        var stackIdx = this._queueStack.length - 1;\n        var stackItem = this._queueStack[stackIdx];\n        DEBUG;\n        DEBUG;\n        task.gen().then(() => {\n          DEBUG;\n          stackItem.popable = true;\n          this.hasTasksToProcess() && this._onMoreTasks();\n        }).catch(ex => {\n          setTimeout(() => {\n            ex.message = `TaskQueue: Error resolving Promise in task ${task.name}: ${ex.message}`;\n            throw ex;\n          }, 0);\n        });\n      }\n    }]);\n  }();\n  var _default = TaskQueue;\n});","lineCount":119,"map":[[2,2,11,0],[2,14,11,12],[4,2,11,13,"Object"],[4,8,11,13],[4,9,11,13,"defineProperty"],[4,23,11,13],[4,24,11,13,"exports"],[4,31,11,13],[5,4,11,13,"value"],[5,9,11,13],[6,2,11,13],[7,2,11,13],[7,11,11,13,"_interopDefault"],[7,27,11,13,"e"],[7,28,11,13],[8,4,11,13],[8,11,11,13,"e"],[8,12,11,13],[8,16,11,13,"e"],[8,17,11,13],[8,18,11,13,"__esModule"],[8,28,11,13],[8,31,11,13,"e"],[8,32,11,13],[9,6,11,13,"default"],[9,13,11,13],[9,15,11,13,"e"],[10,4,11,13],[11,2,11,13],[12,2,183,0,"Object"],[12,8,183,0],[12,9,183,0,"defineProperty"],[12,23,183,0],[12,24,183,0,"exports"],[12,31,183,0],[13,4,183,0,"enumerable"],[13,14,183,0],[14,4,183,0,"get"],[14,7,183,0],[14,18,183,0,"get"],[14,19,183,0],[15,6,183,0],[15,13,183,0,"_default"],[15,21,183,0],[16,4,183,0],[17,2,183,0],[18,2,183,25],[18,6,183,25,"_babelRuntimeHelpersClassCallCheck"],[18,40,183,25],[18,43,183,25,"require"],[18,50,183,25],[18,51,183,25,"_dependencyMap"],[18,65,183,25],[19,2,183,25],[19,6,183,25,"_classCallCheck"],[19,21,183,25],[19,24,183,25,"_interopDefault"],[19,39,183,25],[19,40,183,25,"_babelRuntimeHelpersClassCallCheck"],[19,74,183,25],[20,2,183,25],[20,6,183,25,"_babelRuntimeHelpersCreateClass"],[20,37,183,25],[20,40,183,25,"require"],[20,47,183,25],[20,48,183,25,"_dependencyMap"],[20,62,183,25],[21,2,183,25],[21,6,183,25,"_createClass"],[21,18,183,25],[21,21,183,25,"_interopDefault"],[21,36,183,25],[21,37,183,25,"_babelRuntimeHelpersCreateClass"],[21,68,183,25],[22,2,13,0],[22,6,13,6,"invariant"],[22,15,13,15],[22,18,13,18,"require"],[22,25,13,25],[22,26,13,25,"_dependencyMap"],[22,40,13,25],[22,43,13,37],[22,44,13,38],[23,2,25,0],[23,6,25,6,"DEBUG"],[23,11,25,18],[23,14,25,21],[23,19,25,26],[24,2,25,27],[24,6,43,6,"TaskQueue"],[24,15,43,15],[25,4,51,2],[25,13,51,2,"TaskQueue"],[25,23,51,2,"_ref"],[25,27,51,2],[25,29,51,61],[26,6,51,61],[26,10,51,15,"onMoreTasks"],[26,21,51,26],[26,24,51,26,"_ref"],[26,28,51,26],[26,29,51,15,"onMoreTasks"],[26,40,51,26],[27,6,51,26],[27,10,51,26,"_classCallCheck"],[27,25,51,26],[27,26,51,26,"default"],[27,33,51,26],[27,41,51,26,"TaskQueue"],[27,50,51,26],[28,6,52,4],[28,10,52,8],[28,11,52,9,"_onMoreTasks"],[28,23,52,21],[28,26,52,24,"onMoreTasks"],[28,37,52,35],[29,6,53,4],[29,10,53,8],[29,11,53,9,"_queueStack"],[29,22,53,20],[29,25,53,23],[29,26,53,24],[30,8,53,25,"tasks"],[30,13,53,30],[30,15,53,32],[30,17,53,34],[31,8,53,36,"popable"],[31,15,53,43],[31,17,53,45],[32,6,53,50],[32,7,53,51],[32,8,53,52],[33,4,54,2],[34,4,54,3],[34,15,54,3,"_createClass"],[34,27,54,3],[34,28,54,3,"default"],[34,35,54,3],[34,37,54,3,"TaskQueue"],[34,46,54,3],[35,6,54,3,"key"],[35,9,54,3],[36,6,54,3,"value"],[36,11,54,3],[36,13,61,2],[36,22,61,2,"enqueue"],[36,29,61,9,"enqueue"],[36,30,61,10,"task"],[36,34,61,20],[36,36,61,28],[37,8,62,4],[37,12,62,8],[37,13,62,9,"_getCurrentQueue"],[37,29,62,25],[37,30,62,26],[37,31,62,27],[37,32,62,28,"push"],[37,36,62,32],[37,37,62,33,"task"],[37,41,62,37],[37,42,62,38],[38,6,63,2],[39,4,63,3],[40,6,63,3,"key"],[40,9,63,3],[41,6,63,3,"value"],[41,11,63,3],[41,13,65,2],[41,22,65,2,"enqueueTasks"],[41,34,65,14,"enqueueTasks"],[41,35,65,15,"tasks"],[41,40,65,33],[41,42,65,41],[42,8,66,4,"tasks"],[42,13,66,9],[42,14,66,10,"forEach"],[42,21,66,17],[42,22,66,18,"task"],[42,26,66,22],[42,30,66,26],[42,34,66,30],[42,35,66,31,"enqueue"],[42,42,66,38],[42,43,66,39,"task"],[42,47,66,43],[42,48,66,44],[42,49,66,45],[43,6,67,2],[44,4,67,3],[45,6,67,3,"key"],[45,9,67,3],[46,6,67,3,"value"],[46,11,67,3],[46,13,69,2],[46,22,69,2,"cancelTasks"],[46,33,69,13,"cancelTasks"],[46,34,69,14,"tasksToCancel"],[46,47,69,40],[46,49,69,48],[47,8,71,4],[47,12,71,8],[47,13,71,9,"_queueStack"],[47,24,71,20],[47,27,71,23],[47,31,71,27],[47,32,71,28,"_queueStack"],[47,43,71,39],[47,44,72,7,"map"],[47,47,72,10],[47,48,72,11,"queue"],[47,53,72,16],[47,58,72,21],[48,10,73,8],[48,13,73,11,"queue"],[48,18,73,16],[49,10,74,8,"tasks"],[49,15,74,13],[49,17,74,15,"queue"],[49,22,74,20],[49,23,74,21,"tasks"],[49,28,74,26],[49,29,74,27,"filter"],[49,35,74,33],[49,36,74,34,"task"],[49,40,74,38],[49,44,74,42,"tasksToCancel"],[49,57,74,55],[49,58,74,56,"indexOf"],[49,65,74,63],[49,66,74,64,"task"],[49,70,74,68],[49,71,74,69],[49,78,74,76],[50,8,75,6],[50,9,75,7],[50,10,75,8],[50,11,75,9],[50,12,76,7,"filter"],[50,18,76,13],[50,19,76,14],[50,20,76,15,"queue"],[50,25,76,20],[50,27,76,22,"idx"],[50,30,76,25],[50,35,76,30,"queue"],[50,40,76,35],[50,41,76,36,"tasks"],[50,46,76,41],[50,47,76,42,"length"],[50,53,76,48],[50,56,76,51],[50,57,76,52],[50,61,76,56,"idx"],[50,64,76,59],[50,69,76,64],[50,70,76,65],[50,71,76,66],[51,6,77,2],[52,4,77,3],[53,6,77,3,"key"],[53,9,77,3],[54,6,77,3,"value"],[54,11,77,3],[54,13,89,2],[54,22,89,2,"hasTasksToProcess"],[54,39,89,19,"hasTasksToProcess"],[54,40,89,19],[54,42,89,31],[55,8,90,4],[55,15,90,11],[55,19,90,15],[55,20,90,16,"_getCurrentQueue"],[55,36,90,32],[55,37,90,33],[55,38,90,34],[55,39,90,35,"length"],[55,45,90,41],[55,48,90,44],[55,49,90,45],[56,6,91,2],[57,4,91,3],[58,6,91,3,"key"],[58,9,91,3],[59,6,91,3,"value"],[59,11,91,3],[59,13,96,2],[59,22,96,2,"processNext"],[59,33,96,13,"processNext"],[59,34,96,13],[59,36,96,22],[60,8,97,4],[60,12,97,10,"queue"],[60,17,97,15],[60,20,97,18],[60,24,97,22],[60,25,97,23,"_getCurrentQueue"],[60,41,97,39],[60,42,97,40],[60,43,97,41],[61,8,98,4],[61,12,98,8,"queue"],[61,17,98,13],[61,18,98,14,"length"],[61,24,98,20],[61,26,98,22],[62,10,99,6],[62,14,99,12,"task"],[62,18,99,16],[62,21,99,19,"queue"],[62,26,99,24],[62,27,99,25,"shift"],[62,32,99,30],[62,33,99,31],[62,34,99,32],[63,10,100,6],[63,14,100,10],[64,12,101,8],[64,16,101,12],[64,23,101,19,"task"],[64,27,101,23],[64,32,101,28],[64,40,101,36],[64,44,101,40,"task"],[64,48,101,44],[64,49,101,45,"gen"],[64,52,101,48],[64,54,101,50],[65,14,102,10,"DEBUG"],[65,19,102,15],[66,14,103,10],[66,18,103,14],[66,19,103,15,"_genPromise"],[66,30,103,26],[66,31,103,27,"task"],[66,35,103,31],[66,36,103,32],[67,12,104,8],[67,13,104,9],[67,19,104,15],[67,23,104,19],[67,30,104,26,"task"],[67,34,104,30],[67,39,104,35],[67,47,104,43],[67,51,104,47,"task"],[67,55,104,51],[67,56,104,52,"run"],[67,59,104,55],[67,61,104,57],[68,14,105,10,"DEBUG"],[68,19,105,15],[69,14,106,10,"task"],[69,18,106,14],[69,19,106,15,"run"],[69,22,106,18],[69,23,106,19],[69,24,106,20],[70,12,107,8],[70,13,107,9],[70,19,107,15],[71,14,108,10,"invariant"],[71,23,108,19],[71,24,109,12],[71,31,109,19,"task"],[71,35,109,23],[71,40,109,28],[71,50,109,38],[71,52,110,12],[71,111,110,71],[71,114,111,14,"JSON"],[71,118,111,18],[71,119,111,19,"stringify"],[71,128,111,28],[71,129,111,29,"task"],[71,133,111,33],[71,135,111,35],[71,139,111,39],[71,141,111,41],[71,142,111,42],[71,143,112,10],[71,144,112,11],[72,14,113,10,"DEBUG"],[72,19,113,15],[73,14,114,10,"task"],[73,18,114,14],[73,19,114,15],[73,20,114,16],[74,12,115,8],[75,10,116,6],[75,11,116,7],[75,12,116,8],[75,19,116,15,"e"],[75,20,116,16],[75,22,116,18],[76,12,117,8,"e"],[76,13,117,9],[76,14,117,10,"message"],[76,21,117,17],[76,24,120,10],[76,53,120,39],[76,57,120,43,"task"],[76,61,120,47],[76,62,120,48,"name"],[76,66,120,52],[76,70,120,56],[76,72,120,58],[76,73,120,59],[76,76,120,62],[76,80,120,66],[76,83,120,69,"e"],[76,84,120,70],[76,85,120,71,"message"],[76,92,120,78],[77,12,121,8],[77,18,121,14,"e"],[77,19,121,15],[78,10,122,6],[79,8,123,4],[80,6,124,2],[81,4,124,3],[82,6,124,3,"key"],[82,9,124,3],[83,6,124,3,"value"],[83,11,124,3],[83,13,133,2],[83,22,133,2,"_getCurrentQueue"],[83,38,133,18,"_getCurrentQueue"],[83,39,133,18],[83,41,133,34],[84,8,134,4],[84,12,134,10,"stackIdx"],[84,20,134,18],[84,23,134,21],[84,27,134,25],[84,28,134,26,"_queueStack"],[84,39,134,37],[84,40,134,38,"length"],[84,46,134,44],[84,49,134,47],[84,50,134,48],[85,8,135,4],[85,12,135,10,"queue"],[85,17,135,15],[85,20,135,18],[85,24,135,22],[85,25,135,23,"_queueStack"],[85,36,135,34],[85,37,135,35,"stackIdx"],[85,45,135,43],[85,46,135,44],[86,8,136,4],[86,12,137,6,"queue"],[86,17,137,11],[86,18,137,12,"popable"],[86,25,137,19],[86,29,138,6,"queue"],[86,34,138,11],[86,35,138,12,"tasks"],[86,40,138,17],[86,41,138,18,"length"],[86,47,138,24],[86,52,138,29],[86,53,138,30],[86,57,139,6],[86,61,139,10],[86,62,139,11,"_queueStack"],[86,73,139,22],[86,74,139,23,"length"],[86,80,139,29],[86,83,139,32],[86,84,139,33],[86,86,140,6],[87,10,141,6],[87,14,141,10],[87,15,141,11,"_queueStack"],[87,26,141,22],[87,27,141,23,"pop"],[87,30,141,26],[87,31,141,27],[87,32,141,28],[88,10,142,6,"DEBUG"],[88,15,142,11],[89,10,147,6],[89,17,147,13],[89,21,147,17],[89,22,147,18,"_getCurrentQueue"],[89,38,147,34],[89,39,147,35],[89,40,147,36],[90,8,148,4],[90,9,148,5],[90,15,148,11],[91,10,149,6],[91,17,149,13,"queue"],[91,22,149,18],[91,23,149,19,"tasks"],[91,28,149,24],[92,8,150,4],[93,6,151,2],[94,4,151,3],[95,6,151,3,"key"],[95,9,151,3],[96,6,151,3,"value"],[96,11,151,3],[96,13,153,2],[96,22,153,2,"_genPromise"],[96,33,153,13,"_genPromise"],[96,34,153,14,"task"],[96,38,153,31],[96,40,153,33],[97,8,158,4],[97,12,158,8],[97,13,158,9,"_queueStack"],[97,24,158,20],[97,25,158,21,"push"],[97,29,158,25],[97,30,158,26],[98,10,158,27,"tasks"],[98,15,158,32],[98,17,158,34],[98,19,158,36],[99,10,158,38,"popable"],[99,17,158,45],[99,19,158,47],[100,8,158,52],[100,9,158,53],[100,10,158,54],[101,8,159,4],[101,12,159,10,"stackIdx"],[101,20,159,18],[101,23,159,21],[101,27,159,25],[101,28,159,26,"_queueStack"],[101,39,159,37],[101,40,159,38,"length"],[101,46,159,44],[101,49,159,47],[101,50,159,48],[102,8,160,4],[102,12,160,10,"stackItem"],[102,21,160,19],[102,24,160,22],[102,28,160,26],[102,29,160,27,"_queueStack"],[102,40,160,38],[102,41,160,39,"stackIdx"],[102,49,160,47],[102,50,160,48],[103,8,161,4,"DEBUG"],[103,13,161,9],[104,8,162,4,"DEBUG"],[104,13,162,9],[105,8,163,4,"task"],[105,12,163,8],[105,13,164,7,"gen"],[105,16,164,10],[105,17,164,11],[105,18,164,12],[105,19,165,7,"then"],[105,23,165,11],[105,24,165,12],[105,30,165,18],[106,10,166,8,"DEBUG"],[106,15,166,13],[107,10,171,8,"stackItem"],[107,19,171,17],[107,20,171,18,"popable"],[107,27,171,25],[107,30,171,28],[107,34,171,32],[108,10,172,8],[108,14,172,12],[108,15,172,13,"hasTasksToProcess"],[108,32,172,30],[108,33,172,31],[108,34,172,32],[108,38,172,36],[108,42,172,40],[108,43,172,41,"_onMoreTasks"],[108,55,172,53],[108,56,172,54],[108,57,172,55],[109,8,173,6],[109,9,173,7],[109,10,173,8],[109,11,174,7,"catch"],[109,16,174,12],[109,17,174,13,"ex"],[109,19,174,15],[109,23,174,19],[110,10,175,8,"setTimeout"],[110,20,175,18],[110,21,175,19],[110,27,175,25],[111,12,176,10,"ex"],[111,14,176,12],[111,15,176,13,"message"],[111,22,176,20],[111,25,176,23],[111,71,176,69,"task"],[111,75,176,73],[111,76,176,74,"name"],[111,80,176,78],[111,85,176,83,"ex"],[111,87,176,85],[111,88,176,86,"message"],[111,95,176,93],[111,97,176,95],[112,12,177,10],[112,18,177,16,"ex"],[112,20,177,18],[113,10,178,8],[113,11,178,9],[113,13,178,11],[113,14,178,12],[113,15,178,13],[114,8,179,6],[114,9,179,7],[114,10,179,8],[115,6,180,2],[116,4,180,3],[117,2,180,3],[118,2,183,0],[118,6,183,0,"_default"],[118,14,183,0],[118,17,183,15,"TaskQueue"],[118,26,183,24],[119,0,183,25],[119,3]],"functionMap":{"names":["<global>","TaskQueue","constructor","enqueue","enqueueTasks","tasks.forEach$argument_0","cancelTasks","_queueStack.map$argument_0","queue.tasks.filter$argument_0","_queueStack.map.filter$argument_0","hasTasksToProcess","processNext","_getCurrentQueue","_genPromise","task.gen.then$argument_0","task.gen.then._catch$argument_0","setTimeout$argument_0"],"mappings":"AAA;AC0C;ECQ;GDG;EEO;GFE;EGE;kBCC,0BD;GHC;EKE;WCG;kCCE,0CD;QDC;cGC,mDH;GLC;ESY;GTE;EUK;GV4B;EWS;GXkB;EYE;YCY;ODQ;aEC;mBCC;SDG;OFC;GZC;CDC"},"hasCjsExports":false},"type":"js/module"}]}