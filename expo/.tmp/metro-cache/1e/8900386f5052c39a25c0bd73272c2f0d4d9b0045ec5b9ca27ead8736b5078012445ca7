{"dependencies":[{"name":"@babel/runtime/helpers/objectWithoutProperties","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"fnQVLibs90KHiJ7y48fLgPWzDS0=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/toPropertyKey","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"/LDWO4Lk5pCO4whrd5zrsAqlRow=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":32,"index":101}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useSessions\", {\n    enumerable: true,\n    get: function () {\n      return useSessions;\n    }\n  });\n  var _babelRuntimeHelpersObjectWithoutProperties = require(_dependencyMap[0]);\n  var _objectWithoutProperties = _interopDefault(_babelRuntimeHelpersObjectWithoutProperties);\n  var _babelRuntimeHelpersToPropertyKey = require(_dependencyMap[1]);\n  var _toPropertyKey = _interopDefault(_babelRuntimeHelpersToPropertyKey);\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[2]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[3]);\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _zustand = require(_dependencyMap[4]);\n  var HISTORY_KEY = '@openagents/sessions-history-v1';\n  function wsToHttpBase(wsUrl) {\n    try {\n      var u = new URL(wsUrl);\n      var proto = u.protocol === 'wss:' ? 'https:' : 'http:';\n      var origin = `${proto}//${u.host}`;\n      return origin;\n    } catch {\n      return 'http://localhost:8787';\n    }\n  }\n  var useSessions = (0, _zustand.create)((set, get) => ({\n    history: [],\n    loadingHistory: false,\n    historyLoadedAt: undefined,\n    session: {},\n    loadingSession: {},\n    loadHistory: function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (wsUrl) {\n        var base = wsToHttpBase(wsUrl);\n        set({\n          loadingHistory: true\n        });\n        try {\n          // hydrate cache first\n          try {\n            var raw = yield AsyncStorage.default.getItem(HISTORY_KEY);\n            if (raw) {\n              var cached = JSON.parse(raw);\n              if (Array.isArray(cached?.items)) set({\n                history: cached.items\n              });\n            }\n          } catch {}\n          var res = yield fetch(`${base}/history`);\n          if (!res.ok) throw new Error(`HTTP ${res.status}`);\n          var json = yield res.json();\n          var items = Array.isArray(json.items) ? json.items : [];\n          set({\n            history: items,\n            historyLoadedAt: Date.now()\n          });\n          try {\n            yield AsyncStorage.default.setItem(HISTORY_KEY, JSON.stringify({\n              items\n            }));\n          } catch {}\n        } finally {\n          set({\n            loadingHistory: false\n          });\n        }\n      });\n      return function loadHistory(_x) {\n        return _ref.apply(this, arguments);\n      };\n    }(),\n    loadSession: function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (wsUrl, id, path) {\n        var base = wsToHttpBase(wsUrl);\n        var key = id;\n        var cur = get().session[key];\n        if (cur) return cur;\n        set({\n          loadingSession: {\n            ...get().loadingSession,\n            [key]: true\n          }\n        });\n        try {\n          var url = new URL(`${base}/session`);\n          url.searchParams.set('id', id);\n          if (path) url.searchParams.set('path', path);\n          var res = yield fetch(url.toString());\n          if (!res.ok) return undefined;\n          var json = yield res.json();\n          set({\n            session: {\n              ...get().session,\n              [key]: json\n            }\n          });\n          return json;\n        } finally {\n          var _get$loadingSession = get().loadingSession,\n            _ = _get$loadingSession[key],\n            rest = (0, _objectWithoutProperties.default)(_get$loadingSession, [key].map(_toPropertyKey.default));\n          set({\n            loadingSession: rest\n          });\n        }\n      });\n      return function loadSession(_x2, _x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }()\n  }));\n});","lineCount":124,"map":[[12,2,31,0,"Object"],[12,8,31,0],[12,9,31,0,"defineProperty"],[12,23,31,0],[12,24,31,0,"exports"],[12,31,31,0],[13,4,31,0,"enumerable"],[13,14,31,0],[14,4,31,0,"get"],[14,7,31,0],[14,18,31,0,"get"],[14,19,31,0],[15,6,31,0],[15,13,31,0,"useSessions"],[15,24,31,0],[16,4,31,0],[17,2,31,0],[18,2,79,3],[18,6,79,3,"_babelRuntimeHelpersObjectWithoutProperties"],[18,49,79,3],[18,52,79,3,"require"],[18,59,79,3],[18,60,79,3,"_dependencyMap"],[18,74,79,3],[19,2,79,3],[19,6,79,3,"_objectWithoutProperties"],[19,30,79,3],[19,33,79,3,"_interopDefault"],[19,48,79,3],[19,49,79,3,"_babelRuntimeHelpersObjectWithoutProperties"],[19,92,79,3],[20,2,79,3],[20,6,79,3,"_babelRuntimeHelpersToPropertyKey"],[20,39,79,3],[20,42,79,3,"require"],[20,49,79,3],[20,50,79,3,"_dependencyMap"],[20,64,79,3],[21,2,79,3],[21,6,79,3,"_toPropertyKey"],[21,20,79,3],[21,23,79,3,"_interopDefault"],[21,38,79,3],[21,39,79,3,"_babelRuntimeHelpersToPropertyKey"],[21,72,79,3],[22,2,79,3],[22,6,79,3,"_babelRuntimeHelpersAsyncToGenerator"],[22,42,79,3],[22,45,79,3,"require"],[22,52,79,3],[22,53,79,3,"_dependencyMap"],[22,67,79,3],[23,2,79,3],[23,6,79,3,"_asyncToGenerator"],[23,23,79,3],[23,26,79,3,"_interopDefault"],[23,41,79,3],[23,42,79,3,"_babelRuntimeHelpersAsyncToGenerator"],[23,78,79,3],[24,2,1,0],[24,6,1,0,"_reactNativeAsyncStorageAsyncStorage"],[24,42,1,0],[24,45,1,0,"require"],[24,52,1,0],[24,53,1,0,"_dependencyMap"],[24,67,1,0],[25,2,1,0],[25,6,1,0,"AsyncStorage"],[25,18,1,0],[25,21,1,0,"_interopDefault"],[25,36,1,0],[25,37,1,0,"_reactNativeAsyncStorageAsyncStorage"],[25,73,1,0],[26,2,2,0],[26,6,2,0,"_zustand"],[26,14,2,0],[26,17,2,0,"require"],[26,24,2,0],[26,25,2,0,"_dependencyMap"],[26,39,2,0],[27,2,18,0],[27,6,18,6,"HISTORY_KEY"],[27,17,18,17],[27,20,18,20],[27,53,18,53],[28,2,20,0],[28,11,20,9,"wsToHttpBase"],[28,23,20,21,"wsToHttpBase"],[28,24,20,22,"wsUrl"],[28,29,20,35],[28,31,20,45],[29,4,21,2],[29,8,21,6],[30,6,22,4],[30,10,22,10,"u"],[30,11,22,11],[30,14,22,14],[30,18,22,18,"URL"],[30,21,22,21],[30,22,22,22,"wsUrl"],[30,27,22,27],[30,28,22,28],[31,6,23,4],[31,10,23,10,"proto"],[31,15,23,15],[31,18,23,18,"u"],[31,19,23,19],[31,20,23,20,"protocol"],[31,28,23,28],[31,33,23,33],[31,39,23,39],[31,42,23,42],[31,50,23,50],[31,53,23,53],[31,60,23,60],[32,6,24,4],[32,10,24,10,"origin"],[32,16,24,16],[32,19,24,19],[32,22,24,22,"proto"],[32,27,24,27],[32,32,24,32,"u"],[32,33,24,33],[32,34,24,34,"host"],[32,38,24,38],[32,40,24,40],[33,6,25,4],[33,13,25,11,"origin"],[33,19,25,17],[34,4,26,2],[34,5,26,3],[34,6,26,4],[34,12,26,10],[35,6,27,4],[35,13,27,11],[35,36,27,34],[36,4,28,2],[37,2,29,0],[38,2,31,7],[38,6,31,13,"useSessions"],[38,17,31,24],[38,20,31,27],[38,24,31,27,"create"],[38,32,31,33],[38,33,31,33,"create"],[38,39,31,33],[38,41,31,49],[38,42,31,50,"set"],[38,45,31,53],[38,47,31,55,"get"],[38,50,31,58],[38,56,31,64],[39,4,32,2,"history"],[39,11,32,9],[39,13,32,11],[39,15,32,13],[40,4,33,2,"loadingHistory"],[40,18,33,16],[40,20,33,18],[40,25,33,23],[41,4,34,2,"historyLoadedAt"],[41,19,34,17],[41,21,34,19,"undefined"],[41,30,34,28],[42,4,35,2,"session"],[42,11,35,9],[42,13,35,11],[42,14,35,12],[42,15,35,13],[43,4,36,2,"loadingSession"],[43,18,36,16],[43,20,36,18],[43,21,36,19],[43,22,36,20],[44,4,37,2,"loadHistory"],[44,15,37,13],[45,6,37,13],[45,10,37,13,"_ref"],[45,14,37,13],[45,21,37,13,"_asyncToGenerator"],[45,38,37,13],[45,39,37,13,"default"],[45,46,37,13],[45,48,37,15],[45,59,37,22,"wsUrl"],[45,64,37,35],[45,66,37,40],[46,8,38,4],[46,12,38,10,"base"],[46,16,38,14],[46,19,38,17,"wsToHttpBase"],[46,31,38,29],[46,32,38,30,"wsUrl"],[46,37,38,35],[46,38,38,36],[47,8,39,4,"set"],[47,11,39,7],[47,12,39,8],[48,10,39,10,"loadingHistory"],[48,24,39,24],[48,26,39,26],[49,8,39,31],[49,9,39,32],[49,10,39,33],[50,8,40,4],[50,12,40,8],[51,10,41,6],[52,10,42,6],[52,14,42,10],[53,12,43,8],[53,16,43,14,"raw"],[53,19,43,17],[53,28,43,26,"AsyncStorage"],[53,40,43,38],[53,41,43,38,"default"],[53,48,43,38],[53,49,43,39,"getItem"],[53,56,43,46],[53,57,43,47,"HISTORY_KEY"],[53,68,43,58],[53,69,43,59],[54,12,44,8],[54,16,44,12,"raw"],[54,19,44,15],[54,21,44,17],[55,14,45,10],[55,18,45,16,"cached"],[55,24,45,22],[55,27,45,25,"JSON"],[55,31,45,29],[55,32,45,30,"parse"],[55,37,45,35],[55,38,45,36,"raw"],[55,41,45,39],[55,42,45,69],[56,14,46,10],[56,18,46,14,"Array"],[56,23,46,19],[56,24,46,20,"isArray"],[56,31,46,27],[56,32,46,28,"cached"],[56,38,46,34],[56,40,46,36,"items"],[56,45,46,41],[56,46,46,42],[56,48,46,44,"set"],[56,51,46,47],[56,52,46,48],[57,16,46,50,"history"],[57,23,46,57],[57,25,46,59,"cached"],[57,31,46,65],[57,32,46,66,"items"],[58,14,46,72],[58,15,46,73],[58,16,46,74],[59,12,47,8],[60,10,48,6],[60,11,48,7],[60,12,48,8],[60,18,48,14],[60,19,48,15],[61,10,49,6],[61,14,49,12,"res"],[61,17,49,15],[61,26,49,24,"fetch"],[61,31,49,29],[61,32,49,30],[61,35,49,33,"base"],[61,39,49,37],[61,49,49,47],[61,50,49,48],[62,10,50,6],[62,14,50,10],[62,15,50,11,"res"],[62,18,50,14],[62,19,50,15,"ok"],[62,21,50,17],[62,23,50,19],[62,29,50,25],[62,33,50,29,"Error"],[62,38,50,34],[62,39,50,35],[62,47,50,43,"res"],[62,50,50,46],[62,51,50,47,"status"],[62,57,50,53],[62,59,50,55],[62,60,50,56],[63,10,51,6],[63,14,51,12,"json"],[63,18,51,16],[63,27,51,25,"res"],[63,30,51,28],[63,31,51,29,"json"],[63,35,51,33],[63,36,51,34],[63,37,51,35],[64,10,52,6],[64,14,52,12,"items"],[64,19,52,17],[64,22,52,20,"Array"],[64,27,52,25],[64,28,52,26,"isArray"],[64,35,52,33],[64,36,52,34,"json"],[64,40,52,38],[64,41,52,39,"items"],[64,46,52,44],[64,47,52,45],[64,50,52,49,"json"],[64,54,52,53],[64,55,52,54,"items"],[64,60,52,59],[64,63,52,80],[64,65,52,82],[65,10,53,6,"set"],[65,13,53,9],[65,14,53,10],[66,12,53,12,"history"],[66,19,53,19],[66,21,53,21,"items"],[66,26,53,26],[67,12,53,28,"historyLoadedAt"],[67,27,53,43],[67,29,53,45,"Date"],[67,33,53,49],[67,34,53,50,"now"],[67,37,53,53],[67,38,53,54],[68,10,53,56],[68,11,53,57],[68,12,53,58],[69,10,54,6],[69,14,54,10],[70,12,54,12],[70,18,54,18,"AsyncStorage"],[70,30,54,30],[70,31,54,30,"default"],[70,38,54,30],[70,39,54,31,"setItem"],[70,46,54,38],[70,47,54,39,"HISTORY_KEY"],[70,58,54,50],[70,60,54,52,"JSON"],[70,64,54,56],[70,65,54,57,"stringify"],[70,74,54,66],[70,75,54,67],[71,14,54,69,"items"],[72,12,54,75],[72,13,54,76],[72,14,54,77],[72,15,54,78],[73,10,54,79],[73,11,54,80],[73,12,54,81],[73,18,54,87],[73,19,54,88],[74,8,55,4],[74,9,55,5],[74,18,55,14],[75,10,56,6,"set"],[75,13,56,9],[75,14,56,10],[76,12,56,12,"loadingHistory"],[76,26,56,26],[76,28,56,28],[77,10,56,34],[77,11,56,35],[77,12,56,36],[78,8,57,4],[79,6,58,2],[79,7,58,3],[80,6,58,3],[80,22,37,2,"loadHistory"],[80,33,37,13,"loadHistory"],[80,34,37,13,"_x"],[80,36,37,13],[81,8,37,13],[81,15,37,13,"_ref"],[81,19,37,13],[81,20,37,13,"apply"],[81,25,37,13],[81,32,37,13,"arguments"],[81,41,37,13],[82,6,37,13],[83,4,37,13],[83,7,58,3],[84,4,59,2,"loadSession"],[84,15,59,13],[85,6,59,13],[85,10,59,13,"_ref2"],[85,15,59,13],[85,22,59,13,"_asyncToGenerator"],[85,39,59,13],[85,40,59,13,"default"],[85,47,59,13],[85,49,59,15],[85,60,59,22,"wsUrl"],[85,65,59,35],[85,67,59,37,"id"],[85,69,59,47],[85,71,59,49,"path"],[85,75,59,62],[85,77,59,67],[86,8,60,4],[86,12,60,10,"base"],[86,16,60,14],[86,19,60,17,"wsToHttpBase"],[86,31,60,29],[86,32,60,30,"wsUrl"],[86,37,60,35],[86,38,60,36],[87,8,61,4],[87,12,61,10,"key"],[87,15,61,13],[87,18,61,16,"id"],[87,20,61,18],[88,8,62,4],[88,12,62,10,"cur"],[88,15,62,13],[88,18,62,16,"get"],[88,21,62,19],[88,22,62,20],[88,23,62,21],[88,24,62,22,"session"],[88,31,62,29],[88,32,62,30,"key"],[88,35,62,33],[88,36,62,34],[89,8,63,4],[89,12,63,8,"cur"],[89,15,63,11],[89,17,63,13],[89,24,63,20,"cur"],[89,27,63,23],[90,8,64,4,"set"],[90,11,64,7],[90,12,64,8],[91,10,64,10,"loadingSession"],[91,24,64,24],[91,26,64,26],[92,12,64,28],[92,15,64,31,"get"],[92,18,64,34],[92,19,64,35],[92,20,64,36],[92,21,64,37,"loadingSession"],[92,35,64,51],[93,12,64,53],[93,13,64,54,"key"],[93,16,64,57],[93,19,64,60],[94,10,64,65],[95,8,64,67],[95,9,64,68],[95,10,64,69],[96,8,65,4],[96,12,65,8],[97,10,66,6],[97,14,66,12,"url"],[97,17,66,15],[97,20,66,18],[97,24,66,22,"URL"],[97,27,66,25],[97,28,66,26],[97,31,66,29,"base"],[97,35,66,33],[97,45,66,43],[97,46,66,44],[98,10,67,6,"url"],[98,13,67,9],[98,14,67,10,"searchParams"],[98,26,67,22],[98,27,67,23,"set"],[98,30,67,26],[98,31,67,27],[98,35,67,31],[98,37,67,33,"id"],[98,39,67,35],[98,40,67,36],[99,10,68,6],[99,14,68,10,"path"],[99,18,68,14],[99,20,68,16,"url"],[99,23,68,19],[99,24,68,20,"searchParams"],[99,36,68,32],[99,37,68,33,"set"],[99,40,68,36],[99,41,68,37],[99,47,68,43],[99,49,68,45,"path"],[99,53,68,49],[99,54,68,50],[100,10,69,6],[100,14,69,12,"res"],[100,17,69,15],[100,26,69,24,"fetch"],[100,31,69,29],[100,32,69,30,"url"],[100,35,69,33],[100,36,69,34,"toString"],[100,44,69,42],[100,45,69,43],[100,46,69,44],[100,47,69,45],[101,10,70,6],[101,14,70,10],[101,15,70,11,"res"],[101,18,70,14],[101,19,70,15,"ok"],[101,21,70,17],[101,23,70,19],[101,30,70,26,"undefined"],[101,39,70,35],[102,10,71,6],[102,14,71,12,"json"],[102,18,71,16],[102,27,71,26,"res"],[102,30,71,29],[102,31,71,30,"json"],[102,35,71,34],[102,36,71,35],[102,37,71,56],[103,10,72,6,"set"],[103,13,72,9],[103,14,72,10],[104,12,72,12,"session"],[104,19,72,19],[104,21,72,21],[105,14,72,23],[105,17,72,26,"get"],[105,20,72,29],[105,21,72,30],[105,22,72,31],[105,23,72,32,"session"],[105,30,72,39],[106,14,72,41],[106,15,72,42,"key"],[106,18,72,45],[106,21,72,48,"json"],[107,12,72,53],[108,10,72,55],[108,11,72,56],[108,12,72,57],[109,10,73,6],[109,17,73,13,"json"],[109,21,73,17],[110,8,74,4],[110,9,74,5],[110,18,74,14],[111,10,75,6],[111,14,75,6,"_get$loadingSession"],[111,33,75,6],[111,36,75,36,"get"],[111,39,75,39],[111,40,75,40],[111,41,75,41],[111,42,75,42,"loadingSession"],[111,56,75,56],[112,12,75,21,"_"],[112,13,75,22],[112,16,75,22,"_get$loadingSession"],[112,35,75,22],[112,36,75,15,"key"],[112,39,75,18],[113,12,75,27,"rest"],[113,16,75,31],[113,23,75,31,"_objectWithoutProperties"],[113,47,75,31],[113,48,75,31,"default"],[113,55,75,31],[113,57,75,31,"_get$loadingSession"],[113,76,75,31],[113,79,75,15,"key"],[113,82,75,18],[113,84,75,18,"map"],[113,87,75,18],[113,88,75,18,"_toPropertyKey"],[113,102,75,18],[113,103,75,18,"default"],[113,110,75,18],[114,10,76,6,"set"],[114,13,76,9],[114,14,76,10],[115,12,76,12,"loadingSession"],[115,26,76,26],[115,28,76,28,"rest"],[116,10,76,33],[116,11,76,34],[116,12,76,35],[117,8,77,4],[118,6,78,2],[118,7,78,3],[119,6,78,3],[119,22,59,2,"loadSession"],[119,33,59,13,"loadSession"],[119,34,59,13,"_x2"],[119,37,59,13],[119,39,59,13,"_x3"],[119,42,59,13],[119,44,59,13,"_x4"],[119,47,59,13],[120,8,59,13],[120,15,59,13,"_ref2"],[120,20,59,13],[120,21,59,13,"apply"],[120,26,59,13],[120,33,59,13,"arguments"],[120,42,59,13],[121,6,59,13],[122,4,59,13],[123,2,79,0],[123,3,79,1],[123,4,79,2],[123,5,79,3],[124,0,79,3],[124,3]],"functionMap":{"names":["<global>","wsToHttpBase","create$argument_0","loadHistory","loadSession"],"mappings":"AAA;ACmB;CDS;iDEE;eCM;GDqB;eEC;GFmB;EFC"},"hasCjsExports":false},"type":"js/module"}]}