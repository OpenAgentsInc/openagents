#!/bin/bash
set -e

echo "Installing OpenAgents Harbor agents..."

# Install curl (needed for nvm)
apt-get update
apt-get install -y curl

# Install Node.js via nvm (as root)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.2/install.sh | bash

source "$HOME/.nvm/nvm.sh"

nvm install 22
echo "Node version: $(node -v)"
echo "NPM version: $(npm -v)"

# Install Claude Code CLI
echo "Installing Claude Code CLI..."
npm install -g @anthropic-ai/claude-code@latest || {
    echo "Warning: Could not install @anthropic-ai/claude-code"
}

# Verify claude is available
if command -v claude &> /dev/null; then
    echo "Claude Code CLI installed successfully"
else
    echo "Warning: claude command not found in PATH"
fi

# Install Pi agent
echo "Installing Pi agent..."
npm install -g @mariozechner/pi-coding-agent@latest || {
    echo "Warning: Could not install pi-coding-agent"
}

# Install Python dependencies for test generation
echo "Installing Python test dependencies..."
pip install pytest || apt-get install -y python3-pytest || {
    echo "Warning: Could not install pytest"
}

echo "OpenAgents Harbor agent installation complete!"
