<!DOCTYPE html>
<html lang="en" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenAgents v3</title>
  <!-- Force dark mode FIRST -->
  <script>
    try {
      localStorage.setItem('themeMode', 'dark');
      document.documentElement.classList.add('dark');
    } catch (e) {
      // localStorage may be blocked
    }
  </script>
  <!-- Load our JS FIRST, defer to not block -->
  <script defer src="index.js"></script>
  <!-- Basecoat CSS (includes Tailwind utilities pre-compiled) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/basecoat.cdn.min.css">
  <script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.6/dist/js/all.min.js" defer></script>
  <!-- Tailwind Browser for arbitrary values (debounced to reduce lag) -->
  <script>
    window.tailwindConfig = {
      scan: {
        debounce: 100, // Wait 100ms before re-scanning
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4" defer></script>
  <!-- Local styles -->
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div id="flow-container">
    <svg id="flow-svg" class="flow-svg"></svg>
  </div>

  <!-- MC Tasks Widget (Tailwind) -->
  <div id="mc-tasks-widget" class="hidden"></div>

  <!-- TB Results Dashboard -->
  <div id="tb-results-dashboard" class="hidden"></div>

  <!-- Flow controls hidden - TB trajectory pane is the main UI now -->
  <div id="flow-controls" class="hidden">
    <div id="view-mode-switcher">
      <button id="view-flow-btn" title="MechaCoder View (Ctrl+1)">MC</button>
      <button id="view-tb-btn" class="active" title="Terminal-Bench View (Ctrl+2)">TB</button>
    </div>
    <button id="reset-btn" title="Reset View">Reset</button>
    <span id="zoom-level">100%</span>
  </div>

  <!-- TB Category Tree (hidden, replaced by trajectory pane) -->
  <div id="tb-category-tree" class="hidden">
    <div class="tb-tree-header">
      <span class="tb-tree-label">Task Categories</span>
      <div class="tb-tree-actions">
        <button id="tb-tree-expand" class="small" title="Expand all">+</button>
        <button id="tb-tree-collapse" class="small" title="Collapse all">−</button>
        <button id="tb-tree-close" class="small" title="Close">×</button>
      </div>
    </div>
    <div id="tb-tree-content" class="tb-tree-content"></div>
  </div>

  <!-- Trajectory Pane (left sidebar) -->
  <div id="trajectory-pane" class="trajectory-pane">
    <div class="trajectory-pane-header">
      <h2>TB TRAJECTORIES</h2>
      <!-- <button id="tb-controls-toggle" class="small" title="Toggle TB controls">&#x25BC;</button> -->
    </div>
    <div id="tb-controls-collapsed" class="tb-controls-collapsed">
      <!-- TB Run Controls -->
      <div class="tb-controls-compact">
        <div class="tb-controls-header-compact">
          <span class="tb-label-compact">Terminal-Bench</span>
          <span id="tb-status-compact" class="tb-status-compact">Ready</span>
        </div>
        <input type="text" id="tb-suite-path-compact" placeholder="Suite path..." value="./tasks/terminal-bench-2.json" class="tb-suite-input-compact">
        <div class="tb-buttons-compact">
          <button id="tb-load-btn-compact" title="Load Suite (Ctrl+L)" class="tb-btn-compact">Load</button>
          <button id="tb-start-btn-compact" title="Start Run (Ctrl+T)" class="tb-btn-compact tb-btn-primary">Start</button>
          <button id="tb-random-btn-compact" title="Start Random Task (Ctrl+R)" class="tb-btn-compact tb-btn-secondary">Random</button>
          <button id="tb-stop-btn-compact" title="Stop Run (Ctrl+X)" class="tb-btn-compact tb-btn-danger" disabled>Stop</button>
        </div>
      </div>
    </div>
    <div id="trajectory-list" class="trajectory-list">
      <div class="trajectory-loading">Loading trajectories...</div>
    </div>
  </div>

  <!-- Container Panes -->
  <div id="container-panes" class="container-panes-grid hidden"></div>

  <!-- TB Output Viewer -->
  <div id="tb-output-viewer" class="hidden">
    <div class="tb-output-header">
      <span class="tb-output-label">Agent Output</span>
      <div class="tb-output-actions">
        <button id="tb-output-clear" class="small" title="Clear output">Clear</button>
        <button id="tb-output-copy" class="small" title="Copy to clipboard">Copy</button>
        <button id="tb-output-close" class="small" title="Close">×</button>
      </div>
    </div>
    <div id="tb-output-content" class="tb-output-content"></div>
  </div>

  <!-- TB Run Controls -->
  <div id="tb-controls">
    <div class="tb-controls-header">
      <span class="tb-label">Terminal-Bench</span>
      <span id="tb-status" class="tb-status">Ready</span>
    </div>
    <div class="tb-controls-body">
      <input type="text" id="tb-suite-path" placeholder="Suite path..." value="./tasks/terminal-bench-2.json">
      <div class="tb-buttons">
        <button id="tb-load-btn" title="Load Suite (Ctrl+L)">Load</button>
        <button id="tb-start-btn" title="Start Run (Ctrl+T)" class="primary">Start</button>
        <button id="tb-random-btn" title="Start Random Task (Ctrl+R)" class="secondary">Random</button>
        <button id="tb-stop-btn" title="Stop Run (Ctrl+X)" class="danger" disabled>Stop</button>
      </div>
    </div>
    <div id="tb-task-selector" class="tb-task-selector hidden">
      <div class="tb-task-header">
        <span id="tb-suite-name">No suite loaded</span>
        <button id="tb-select-all" class="small">All</button>
        <button id="tb-select-none" class="small">None</button>
      </div>
      <div id="tb-task-list" class="tb-task-list"></div>
    </div>
  </div>
</body>

</html>
